/*
 * Copyright (C) 2016-2023 Slava Monich <slava@monich.com>
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 *
 *  1. Redistributions of source code must retain the above copyright
 *     notice, this list of conditions and the following disclaimer.
 *  2. Redistributions in binary form must reproduce the above copyright
 *     notice, this list of conditions and the following disclaimer
 *     in the documentation and/or other materials provided with the
 *     distribution.
 *  3. Neither the names of the copyright holders nor the names of its
 *     contributors may be used to endorse or promote products derived
 *     from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
 * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
 * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
 * IN NO EVENT SHALL THE CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
 * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
 * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) ARISING
 * IN ANY WAY OUT OF THE USE OR INABILITY TO USE THIS SOFTWARE, EVEN
 * IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * The views and conclusions contained in the software and documentation
 * are those of the authors and should not be interpreted as representing
 * any official policies, either expressed or implied.
 */

#include "test_common.h"
#include "foilmsg_p.h"

#include <foil_key.h>
#include <foil_private_key.h>
#include <foil_output.h>
#include <foil_util.h>

#include <gutil_misc.h>

#include <glib/gstdio.h>

#define DATA_DIR "data/"

typedef struct test_foilmsg_to_binary {
    const char* name;
    FoilBytes in;
    const void* out;
    guint out_size;
} TestFoilMsgConvertToBinary;

typedef struct test_foilmsg_key_files {
    const char* from_priv;
    const char* from_pub;
    const char* to_priv;
    const char* to_pub;
} TestFoilKeyFiles;

typedef struct test_foilmsg {
    const char* name;
    GTestDataFunc fn;
    const char* plain_text;
    TestFoilKeyFiles key_files;
    const FoilMsgEncryptOptions *options;
    gboolean flags;

#define TEST_LINE_BREAKS   (0x01)
#define TEST_ENCRYPT_ERROR (0x02)
#define TEST_DECRYPT_ERROR (0x04)
#define TEST_VERIFY_ERROR  (0x08)

} TestFoilMsg;

typedef struct test_foilmsg_decrypt_error {
    const char* name;
    FoilBytes data;
    TestFoilKeyFiles key_files;
} TestFoilMsgDecryptError;

typedef struct test_foilmsg_garbage {
    const char* name;
    const char* garbage;
} TestFoilMsgGarbage;

typedef struct test_foilmsg_keys {
    FoilPrivateKey* from_priv;
    FoilPrivateKey* to_priv;
    FoilKey* from_pub;
    FoilKey* to_pub;
} TestFoilMsgKeys;

static
void
test_foilmsg_keys_init(
    TestFoilMsgKeys* keys,
    const TestFoilKeyFiles* test)
{
    memset(keys, 0, sizeof(*keys));
    if (test->from_priv) {
        char* path = g_strconcat(DATA_DIR, test->from_priv, NULL);
        keys->from_priv = foil_private_key_new_from_file(FOIL_KEY_RSA_PRIVATE,
            path);
        g_free(path);
    }
    if (test->from_pub) {
        char* path = g_strconcat(DATA_DIR, test->from_pub, NULL);
        keys->from_pub = foil_key_new_from_file(FOIL_KEY_RSA_PUBLIC, path);
        g_free(path);
    }
    if (test->to_priv) {
        char* path = g_strconcat(DATA_DIR, test->to_priv, NULL);
        keys->to_priv = foil_private_key_new_from_file(FOIL_KEY_RSA_PRIVATE,
            path);
        g_free(path);
    }
    if (test->to_pub) {
        char* path = g_strconcat(DATA_DIR, test->to_pub, NULL);
        keys->to_pub = foil_key_new_from_file(FOIL_KEY_RSA_PUBLIC, path);
        g_free(path);
    }
}

static
void
test_foilmsg_keys_deinit(
    TestFoilMsgKeys* keys)
{
    foil_private_key_unref(keys->from_priv);
    foil_private_key_unref(keys->to_priv);
    foil_key_unref(keys->from_pub);
    foil_key_unref(keys->to_pub);
}

static
void
test_foilmsg_invalid(
    void)
{
    FoilPrivateKey* priv = foil_private_key_new_from_file(FOIL_KEY_RSA_PRIVATE,
        DATA_DIR "rsa-1024");
    char* tmp = g_dir_make_tmp("foil_XXXXXX", NULL);
    g_assert(priv);
    g_assert(tmp);
    g_rmdir(tmp);

    foilmsg_free(NULL);
    foilmsg_info_free(NULL);
    g_assert(!foilmsg_to_binary(NULL));
    g_assert(!foilmsg_encrypt(NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL));
    //g_assert(!foilmsg_encrypt_file(NULL, NULL, NULL, NULL, NULL, NULL, NULL));
    g_assert(!foilmsg_encrypt_to_bytes(NULL, NULL, NULL, NULL, NULL, NULL));
    g_assert(!foilmsg_encrypt_text(NULL, NULL, NULL, 0, NULL));
    g_assert(!foilmsg_encrypt_text_to_bytes(NULL, NULL, NULL, NULL));
    g_assert(!foilmsg_decrypt(NULL, NULL, NULL));
    g_assert(!foilmsg_decrypt_file(NULL, NULL, NULL));
    g_assert(!foilmsg_decrypt_file(priv, NULL, NULL));
    g_assert(!foilmsg_decrypt_file(priv, tmp, NULL));
    g_assert(!foilmsg_decrypt_text(NULL, NULL));
    g_assert(!foilmsg_decrypt_text(priv, NULL));
    g_assert(!foilmsg_decrypt_text_len(NULL, NULL, 0));
    g_assert(!foilmsg_decrypt_text_len(priv, NULL, 0));
    g_assert(!foilmsg_decrypt_text_bytes(NULL, NULL, NULL));
    g_assert(!foilmsg_decrypt_text_bytes(priv, NULL, NULL));
    g_assert(!foilmsg_verify(NULL, NULL));
    foil_private_key_unref(priv);
    g_free(tmp);
}

static
void
test_foilmsg_options(
    void)
{
    FoilMsgEncryptOptions opt;
    memset(&opt, 0xff, sizeof(opt));
    g_assert(!foilmsg_encrypt_defaults(NULL));
    g_assert(foilmsg_encrypt_defaults(&opt) == &opt);
    g_assert(opt.key_type == FOILMSG_KEY_TYPE_DEFAULT);
    g_assert(opt.flags == 0);
    g_assert(opt.cipher == FOILMSG_CIPHER_DEFAULT);
    g_assert(opt.signature == FOILMSG_SIGNATURE_DEFAULT);
}

static
void
test_foilmsg_decrypt_file(
    void)
{
    FoilPrivateKey* priv = foil_private_key_new_from_file(FOIL_KEY_RSA_PRIVATE,
        DATA_DIR "rsa-1024");
    FoilKey* pub = foil_public_key_new_from_private(priv);
    char* tmpdir = g_dir_make_tmp("foil_XXXXXX", NULL);
    char* tmpfile = g_strconcat(tmpdir, G_DIR_SEPARATOR_S "test", NULL);
    FoilOutput* out = foil_output_file_new_open(tmpfile);
    FoilMsg* msg;
    FoilBytes in;

    g_assert(priv);
    g_assert(pub);
    g_assert(out);
    foil_bytes_from_string(&in, "This is a test");
    g_assert(foilmsg_encrypt(out, &in, NULL, NULL, priv, pub, NULL, NULL));
    foil_output_unref(out);

    msg = foilmsg_decrypt_file(priv, tmpfile, NULL);
    g_assert(msg);
    g_assert(gutil_bytes_equal(msg->data, in.val,  in.len));
    foilmsg_free(msg);

    foil_private_key_unref(priv);
    foil_key_unref(pub);
    g_remove(tmpfile);
    g_rmdir(tmpdir);
    g_free(tmpfile);
    g_free(tmpdir);
}

static
void
test_foilmsg_encrypt_self(
    void)
{
    FoilPrivateKey* priv = foil_private_key_new_from_file(FOIL_KEY_RSA_PRIVATE,
        DATA_DIR "rsa-1024");
    FoilKey* pub = foil_public_key_new_from_private(priv);
    FoilKey* pub2 = foil_key_new_from_file(FOIL_KEY_RSA_PUBLIC,
        DATA_DIR "rsa-768.pub");
    FoilMsgEncryptOptions opts;
    const char* text = "This is a test";
    const guint len = strlen(text);
    FoilBytes bytes;
    FoilMsg* msg;
    GBytes* enc1;
    GBytes* enc2;
    GBytes* enc3;

    g_assert(priv);
    g_assert(pub);
    g_assert(pub2);
    memset(&opts, 0, sizeof(opts));

    /* Public key in one form or another is required */
    g_assert(!foilmsg_encrypt_text_to_bytes(text, priv, NULL, &opts));

    /* This one we will fail to decrypt (not encrypted to self) */
    enc1 = foilmsg_encrypt_text_to_bytes(text, priv, pub2, &opts);
    g_assert(enc1);
    msg = foilmsg_decrypt(priv, foil_bytes_from_data(&bytes, enc1), NULL);
    g_assert(!msg);
    g_bytes_unref(enc1);

    /* Make sure that duplicate public keys don't get included */
    enc1 = foilmsg_encrypt_text_to_bytes(text, priv, pub, &opts);
    g_assert(enc1);
    opts.flags |= FOILMSG_FLAG_ENCRYPT_FOR_SELF;
    enc2 = foilmsg_encrypt_text_to_bytes(text, priv, NULL, &opts);
    g_assert(enc2);
    enc3 = foilmsg_encrypt_text_to_bytes(text, priv, pub, &opts);
    g_assert(enc3);

    /* All those should have the same size */
    g_assert(g_bytes_get_size(enc1) > 0);
    g_assert(g_bytes_get_size(enc1) == g_bytes_get_size(enc2));
    g_assert(g_bytes_get_size(enc1) == g_bytes_get_size(enc3));

    /* And they all should get decrypted */
    msg = foilmsg_decrypt(priv, foil_bytes_from_data(&bytes, enc1), NULL);
    g_assert(msg);
    g_assert(gutil_bytes_equal(msg->data, text,  len));
    foilmsg_free(msg);
    g_bytes_unref(enc1);

    msg = foilmsg_decrypt(priv, foil_bytes_from_data(&bytes, enc2), NULL);
    g_assert(msg);
    g_assert(gutil_bytes_equal(msg->data, text,  len));
    foilmsg_free(msg);
    g_bytes_unref(enc2);

    msg = foilmsg_decrypt(priv, foil_bytes_from_data(&bytes, enc3), NULL);
    g_assert(msg);
    g_assert(gutil_bytes_equal(msg->data, text,  len));
    foilmsg_free(msg);
    g_bytes_unref(enc3);

    foil_private_key_unref(priv);
    foil_key_unref(pub);
    foil_key_unref(pub2);
}

static
void
test_foilmsg_to_binary(
    gconstpointer param)
{
    const TestFoilMsgConvertToBinary* test = param;
    GBytes* bytes = foilmsg_to_binary(&test->in);
    g_assert(gutil_bytes_equal(bytes, test->out, test->out_size));
    g_bytes_unref(bytes);
}

static
void
test_foilmsg_decrypt_garbage(
    gconstpointer param)
{
    const TestFoilMsgGarbage* test = param;
    FoilPrivateKey* priv = foil_private_key_new_from_file(FOIL_KEY_RSA_PRIVATE,
        DATA_DIR "rsa-1024");
    g_assert(priv);
    g_assert(!foilmsg_decrypt_text(priv, test->garbage));
    foil_private_key_unref(priv);
}

static
void
test_foilmsg_binary(
    gconstpointer param)
{
    const TestFoilMsg* test = param;
    TestFoilMsgKeys keys;
    GBytes* enc;
    FoilMsg* msg;
    FoilBytes enc_bytes;

    test_foilmsg_keys_init(&keys, &test->key_files);
    enc = foilmsg_encrypt_text_to_bytes(test->plain_text,
        keys.from_priv, keys.to_pub, test->options);
    g_assert(enc);

    enc_bytes.val = g_bytes_get_data(enc, &enc_bytes.len);
    msg = foilmsg_decrypt(keys.to_priv, &enc_bytes, NULL);
    GDEBUG("Encrypted message:");
    TEST_DEBUG_HEXDUMP_BYTES(enc);
    g_assert(msg);
    GDEBUG("Decrypted message:");
    TEST_DEBUG_HEXDUMP_BYTES(msg->data);
    g_assert(foilmsg_verify(msg, keys.from_pub));
    g_assert(!foilmsg_verify(msg, NULL));
    foilmsg_free(msg);
    g_bytes_unref(enc);

    test_foilmsg_keys_deinit(&keys);
}

static
void
test_foilmsg_text(
    gconstpointer param)
{
    const TestFoilMsg* test = param;
    TestFoilMsgKeys keys;
    GString* enc;
    FoilMsg* msg;

    test_foilmsg_keys_init(&keys, &test->key_files);
    enc = foilmsg_encrypt_text(test->plain_text, keys.from_priv,
        keys.to_pub, (test->flags & TEST_LINE_BREAKS) ? 64 : 0, test->options);
    if (enc) {
        g_assert(!(test->flags & TEST_ENCRYPT_ERROR));
        GDEBUG("Encrypted message (%u bytes):\n%s", (guint)enc->len, enc->str);
        msg = foilmsg_decrypt_text_len(keys.to_priv, enc->str, enc->len);
        if (msg) {
            g_assert(!(test->flags & TEST_DECRYPT_ERROR));
            GDEBUG("Decrypted message (%u bytes):",
                (guint)g_bytes_get_size(msg->data));
            TEST_DEBUG_HEXDUMP_BYTES(msg->data);
            g_assert(foilmsg_verify(msg, keys.from_pub) ==
                !(test->flags & TEST_VERIFY_ERROR));
            foilmsg_free(msg);
        } else {
            g_assert(test->flags & TEST_DECRYPT_ERROR);
        }
        g_string_free(enc, TRUE);
    } else {
        g_assert(test->flags & TEST_ENCRYPT_ERROR);
    }

    test_foilmsg_keys_deinit(&keys);
}

static
void
test_foilmsg_headers2(
    const TestFoilMsg* test,
    FoilOutput* tmp)
{
    TestFoilMsgKeys keys;
    const char* content_type = "text/plain";
    static const FoilMsgHeader header [] = {
        { "Name", "Value" },
        { "AnotherName", "AnotherValue" }
    };
    static const FoilMsgHeaders headers = { header, G_N_ELEMENTS(header) };
    FoilOutput* out = foil_output_mem_new(NULL);
    FoilMsg* msg;
    FoilBytes enc_bytes;
    GBytes* enc;
    FoilBytes data;
    guint i;

    data.val = (const void*)test->plain_text;
    data.len = strlen(test->plain_text);
    test_foilmsg_keys_init(&keys, &test->key_files);

    g_assert(foilmsg_encrypt(out, &data, content_type, &headers, keys.from_priv,
        keys.to_pub, test->options, tmp));

    enc = foil_output_free_to_bytes(foil_output_ref(out));
    enc_bytes.val = g_bytes_get_data(enc, &enc_bytes.len);
    g_assert(!foilmsg_decrypt(keys.to_priv, NULL, NULL));
    msg = foilmsg_decrypt(keys.to_priv, &enc_bytes, NULL);
    g_assert(msg);
    GDEBUG("Encrypted message:");
    TEST_DEBUG_HEXDUMP_BYTES(enc);
    g_assert(msg);
    GDEBUG("Decrypted message:");
    TEST_DEBUG_HEXDUMP_BYTES(msg->data);
    g_assert(foilmsg_verify(msg, keys.from_pub) ==
        !(test->flags & TEST_VERIFY_ERROR));
    g_assert(msg->headers.count == G_N_ELEMENTS(header));

    /* Check headers */
    for (i=0; i<msg->headers.count; i++) {
        const FoilMsgHeader* h = msg->headers.header + i;
        g_assert(!g_strcmp0(h->name, header[i].name));
        g_assert(!g_strcmp0(h->value, header[i].value));
    }

    g_assert(!foilmsg_get_value(NULL, NULL));
    g_assert(!foilmsg_get_value(msg, NULL));
    g_assert(!foilmsg_get_value(msg, "NoSuchHeader"));
    g_assert(!g_strcmp0(foilmsg_get_value(msg, "Name"), "Value"));

    foilmsg_free(msg);
    g_bytes_unref(enc);

    test_foilmsg_keys_deinit(&keys);
    foil_output_unref(out);
}

static
void
test_foilmsg_headers(
    gconstpointer param)
{
    test_foilmsg_headers2(param, NULL);
}

static
void
test_foilmsg_tmp_file(
    gconstpointer param)
{
    FoilOutput* tmp = foil_output_file_new_tmp();
    test_foilmsg_headers2(param, tmp);
    foil_output_unref(tmp);
}

static
void
test_foilmsg_decrypt_error(
    gconstpointer param)
{
    const TestFoilMsgDecryptError* test = param;
    FoilOutput* out = foil_output_mem_new(NULL);
    TestFoilMsgKeys keys;
    test_foilmsg_keys_init(&keys, &test->key_files);
    g_assert(!foilmsg_decrypt(keys.to_priv, &test->data, out));
    foil_output_unref(out);
    test_foilmsg_keys_deinit(&keys);
}

static
void
test_foilmsg_verify_error(
    gconstpointer param)
{
    const TestFoilMsgDecryptError* test = param;
    TestFoilMsgKeys keys;
    FoilMsg* msg;
    test_foilmsg_keys_init(&keys, &test->key_files);
    msg = foilmsg_decrypt(keys.to_priv, &test->data, NULL);
    g_assert(msg);
    g_assert(keys.from_pub);
    g_assert(!foilmsg_verify(msg, keys.from_pub));
    foilmsg_free(msg);
    test_foilmsg_keys_deinit(&keys);
}

#define TEST_(name) "/foilmsg/" name

static const char foilmsg_prefix_only[] = FOILMSG_PREFIX;
static const char foilmsg_prefix_and_spaces[] = " " FOILMSG_PREFIX "  ";
static const char foilmsg_no_prefix[] = " WHATEVER ";
static const char foilmsg_invalid_base64[] = FOILMSG_PREFIX " ABCD....";

static const TestFoilMsgConvertToBinary foilmsg_convert_tests[] = {
    {
        TEST_("ConvertEmpty"),
        { (gconstpointer)foilmsg_prefix_only, 0 },
          (gconstpointer)foilmsg_convert_tests, 0 /* Equals empty GBytes */
    },{
        TEST_("ConvertShort1"),
        { (gconstpointer)foilmsg_prefix_only, 1 },
        foilmsg_prefix_only, 1
    }, {
        TEST_("ConvertPrefix"),
        { (gconstpointer)foilmsg_prefix_only, FOILMSG_PREFIX_LENGTH },
          (gconstpointer)foilmsg_convert_tests, 0 /* Equals empty GBytes */
    }, {
        TEST_("ConvertPrefixAndSpaces"),
        {
            (gconstpointer)foilmsg_prefix_and_spaces,
            G_N_ELEMENTS(foilmsg_prefix_and_spaces)-1
        },
        (gconstpointer)foilmsg_convert_tests, 0 /* Equals empty GBytes */
    }, {
        TEST_("ConvertNoPrefix"),
        { (gconstpointer)TEST_ARRAY_AND_SIZE(foilmsg_no_prefix) },
        TEST_ARRAY_AND_SIZE(foilmsg_no_prefix)
    }, {
        TEST_("ConvertInvalidBase64"),
        { (gconstpointer)TEST_ARRAY_AND_SIZE(foilmsg_invalid_base64) },
        TEST_ARRAY_AND_SIZE(foilmsg_invalid_base64)
    }
};

static const FoilMsgEncryptOptions options_invalid_key_type = {
    (FOILMSG_KEY_TYPE)-1, 0, FOILMSG_CIPHER_DEFAULT,
    FOILMSG_SIGNATURE_DEFAULT
};

static const FoilMsgEncryptOptions options_invalid_enc_cipher = {
    FOILMSG_KEY_TYPE_DEFAULT, 0, (FOILMSG_CIPHER)-1,
    FOILMSG_SIGNATURE_DEFAULT
};

static const FoilMsgEncryptOptions options_aes_128 = {
    FOILMSG_KEY_AES_128, 0, FOILMSG_CIPHER_DEFAULT,
    FOILMSG_SIGNATURE_DEFAULT
};

static const FoilMsgEncryptOptions options_aes_128_self = {
    FOILMSG_KEY_AES_128, FOILMSG_FLAG_ENCRYPT_FOR_SELF,
    FOILMSG_CIPHER_AES_CBC, FOILMSG_SIGNATURE_DEFAULT
};

static const FoilMsgEncryptOptions options_aes_128_cfb_self = {
    FOILMSG_KEY_AES_128, FOILMSG_FLAG_ENCRYPT_FOR_SELF,
    FOILMSG_CIPHER_AES_CFB, FOILMSG_SIGNATURE_DEFAULT
};

static const FoilMsgEncryptOptions options_aes_128_ctr_self = {
    FOILMSG_KEY_AES_128, FOILMSG_FLAG_ENCRYPT_FOR_SELF,
    FOILMSG_CIPHER_AES_CTR, FOILMSG_SIGNATURE_DEFAULT
};

static const FoilMsgEncryptOptions options_aes_192_self = {
    FOILMSG_KEY_AES_192, FOILMSG_FLAG_ENCRYPT_FOR_SELF,
    FOILMSG_CIPHER_AES_CBC, FOILMSG_SIGNATURE_DEFAULT
};

static const FoilMsgEncryptOptions options_aes_192_cfb_self = {
    FOILMSG_KEY_AES_192, FOILMSG_FLAG_ENCRYPT_FOR_SELF,
    FOILMSG_CIPHER_AES_CFB, FOILMSG_SIGNATURE_DEFAULT
};

static const FoilMsgEncryptOptions options_aes_192_ctr_self = {
    FOILMSG_KEY_AES_192, FOILMSG_FLAG_ENCRYPT_FOR_SELF,
    FOILMSG_CIPHER_AES_CTR, FOILMSG_SIGNATURE_DEFAULT
};

static const FoilMsgEncryptOptions options_aes_256_self = {
    FOILMSG_KEY_AES_256, FOILMSG_FLAG_ENCRYPT_FOR_SELF,
    FOILMSG_CIPHER_AES_CBC, FOILMSG_SIGNATURE_DEFAULT
};

static const FoilMsgEncryptOptions options_aes_256_cfb_self = {
    FOILMSG_KEY_AES_256, FOILMSG_FLAG_ENCRYPT_FOR_SELF,
    FOILMSG_CIPHER_AES_CFB, FOILMSG_SIGNATURE_DEFAULT
};

static const FoilMsgEncryptOptions options_aes_256_ctr_self = {
    FOILMSG_KEY_AES_256, FOILMSG_FLAG_ENCRYPT_FOR_SELF,
    FOILMSG_CIPHER_AES_CTR, FOILMSG_SIGNATURE_DEFAULT
};

static const FoilMsgEncryptOptions options_aes_256_sha1_rsa = {
    FOILMSG_KEY_AES_256, FOILMSG_FLAG_ENCRYPT_FOR_SELF,
    FOILMSG_CIPHER_AES_CBC, FOILMSG_SIGNATURE_SHA1_RSA
};

static const FoilMsgEncryptOptions options_aes_256_sha256_rsa = {
    FOILMSG_KEY_AES_256, FOILMSG_FLAG_ENCRYPT_FOR_SELF,
    FOILMSG_CIPHER_AES_CBC, FOILMSG_SIGNATURE_SHA256_RSA
};

static const FoilMsgEncryptOptions options_aes_256_sha512_rsa = {
    FOILMSG_KEY_AES_256, FOILMSG_FLAG_ENCRYPT_FOR_SELF,
    FOILMSG_CIPHER_AES_CBC, FOILMSG_SIGNATURE_SHA512_RSA
};

static const FoilMsgEncryptOptions options_aes_256_invalid_sig_alg = {
    FOILMSG_KEY_AES_256, FOILMSG_FLAG_ENCRYPT_FOR_SELF,
    FOILMSG_CIPHER_AES_CBC, (FOILMSG_SIGNATURE)-1
};

static const TestFoilMsg foilmsg_tests[] = {
    {
        TEST_("Binary"), test_foilmsg_binary,
        "This is a test",
        {"rsa-768", "rsa-768.pub", "rsa-1024", "rsa-1024.pub" },
        &options_aes_128
    },{
        TEST_("Defaults"), test_foilmsg_text,
         "Test of default options",
        { "rsa-768", "rsa-768.pub", "rsa-1024", "rsa-1024.pub" },
        NULL, TEST_LINE_BREAKS
    },{
        TEST_("InvalidKeyType"), test_foilmsg_text,
         "Test of invalid key type option",
        { "rsa-768", "rsa-768.pub", "rsa-1024", "rsa-1024.pub" },
        &options_invalid_key_type, TEST_ENCRYPT_ERROR
    },{
        TEST_("InvalidCipher"), test_foilmsg_text,
         "Test of invalid encryption cipher",
        { "rsa-768", "rsa-768.pub", "rsa-1024", "rsa-1024.pub" },
        &options_invalid_enc_cipher, TEST_ENCRYPT_ERROR
    },{
        TEST_("AESCBC/128bit"), test_foilmsg_text,
         "Test of 128-bit encryption",
        { "rsa-768", "rsa-768.pub", "rsa-1024", "rsa-1024.pub" },
        &options_aes_128_self
    },{
        TEST_("AESCFB/128bit"), test_foilmsg_text,
         "Test of 128-bit encryption (CFB mode)",
        { "rsa-768", "rsa-768.pub", "rsa-1024", "rsa-1024.pub" },
        &options_aes_128_cfb_self
    },{
        TEST_("AESCTR/128bit"), test_foilmsg_text,
         "Test of 128-bit encryption (CTR mode)",
        { "rsa-768", "rsa-768.pub", "rsa-1024", "rsa-1024.pub" },
        &options_aes_128_ctr_self
    },{
        TEST_("AESCBC/192bit"), test_foilmsg_text,
         "Test of 192-bit encryption",
        { "rsa-768", "rsa-768.pub", "rsa-1024", "rsa-1024.pub" },
        &options_aes_192_self
    },{
        TEST_("AESCFB/192bit"), test_foilmsg_text,
         "Test of 192-bit encryption (CFB mode)",
        { "rsa-768", "rsa-768.pub", "rsa-1024", "rsa-1024.pub" },
        &options_aes_192_cfb_self
    },{
        TEST_("AESCTR/192bit"), test_foilmsg_text,
         "Test of 192-bit encryption (CTR mode)",
        { "rsa-768", "rsa-768.pub", "rsa-1024", "rsa-1024.pub" },
        &options_aes_192_ctr_self
    },{
        TEST_("AESCBC/256bit"), test_foilmsg_text,
         "Test of 256-bit encryption",
        { "rsa-768", "rsa-768.pub", "rsa-1024", "rsa-1024.pub" },
        &options_aes_256_self
    },{
        TEST_("AESCFB/256bit"), test_foilmsg_text,
         "Test of 256-bit encryption (CFB mode)",
        { "rsa-768", "rsa-768.pub", "rsa-1024", "rsa-1024.pub" },
        &options_aes_256_cfb_self
    },{
        TEST_("AESCTR/256bit"), test_foilmsg_text,
         "Test of 256-bit encryption (CTR mode)",
        { "rsa-768", "rsa-768.pub", "rsa-1024", "rsa-1024.pub" },
        &options_aes_256_ctr_self
    },{
        TEST_("SelfDecrypt"), test_foilmsg_text,
        "Sender should be able to decrypt this",
        { "rsa-768", "rsa-768.pub", "rsa-768", "rsa-1024.pub" },
        &options_aes_128_self
    },{
        TEST_("SelfDecryptFailure"), test_foilmsg_text,
        "Sender won't be able to decrypt this",
        { "rsa-768", "rsa-768.pub", "rsa-768", "rsa-1024.pub" },
        &options_aes_128, TEST_DECRYPT_ERROR
    },{
        TEST_("Signature/SHA1"), test_foilmsg_text,
         "Test of SHA1/RSA signature",
        { "rsa-768", "rsa-768.pub", "rsa-1024", "rsa-1024.pub" },
        &options_aes_256_sha1_rsa
    },{
        TEST_("Signature/SHA256"), test_foilmsg_text,
         "Test of SHA256/RSA signature",
        { "rsa-768", "rsa-768.pub", "rsa-1024", "rsa-1024.pub" },
        &options_aes_256_sha256_rsa
    },{
        TEST_("Signature/SHA512"), test_foilmsg_text,
         "Test of SHA512/RSA signature",
        { "rsa-768", "rsa-768.pub", "rsa-1024", "rsa-1024.pub" },
        &options_aes_256_sha512_rsa
    },{
        TEST_("Signature/Invalid"), test_foilmsg_text,
         "Test of invalid signature algorithm",
        { "rsa-768", "rsa-768.pub", "rsa-1024", "rsa-1024.pub" },
        &options_aes_256_invalid_sig_alg, TEST_ENCRYPT_ERROR
    },{
        TEST_("FingerprintCheckFailure"), test_foilmsg_text,
        "Fingerprint check is going to fail",
        { "rsa-768", "rsa-1024.pub", "rsa-1024", "rsa-1024.pub" },
        &options_aes_128, TEST_VERIFY_ERROR
    },{
        TEST_("Headers"), test_foilmsg_headers,
        "This is a test for headers",
        { "rsa-768", "rsa-768.pub", "rsa-1024", "rsa-1024.pub" },
        &options_aes_128
    },{
        TEST_("TemporaryFile"), test_foilmsg_tmp_file,
        "Test of temporary file",
        { "rsa-1024", "rsa-1024.pub", "rsa-768", "rsa-768.pub" },
        &options_aes_128
    }
};


static const guint8 valid_data[] = {
0x30,0x82,0x01,0xd7,0x02,0x01,0x01,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9a,0x76,
0xf1,0x62,0xd8,0x7c,0x81,0x2d,0x03,0xf6,0xf0,0x6b,0x9a,0x1f,0xd1,0x69,0x30,0x82,
0x01,0x1b,0x02,0x01,0x01,0x30,0x81,0x9a,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9b,
0xf5,0xc4,0xeb,0xc2,0xf0,0xa0,0x2b,0xde,0xf6,0x37,0x63,0xf6,0x0c,0x30,0x2c,0x04,
0x81,0x80,0x89,0x05,0xd7,0x16,0xe3,0x8d,0x9c,0x88,0x57,0x13,0x10,0xe9,0xb7,0xa0,
0x95,0x91,0x1f,0x85,0xa9,0xa1,0x05,0x63,0x4f,0x04,0x9d,0xa7,0x8f,0x32,0x85,0x6c,
0xb6,0x34,0x23,0x4d,0xa2,0x1a,0xa4,0x07,0xa2,0x03,0x39,0x6a,0xf4,0xbf,0x13,0xf1,
0xa6,0x7d,0xb4,0x38,0xe8,0x5d,0xc7,0x3e,0xfd,0xe5,0x28,0xe0,0xca,0xce,0xf7,0xdf,
0x2d,0xd8,0x5f,0x03,0xed,0x8c,0x96,0xe8,0x1f,0xab,0x4e,0x8e,0xab,0xb8,0x53,0x34,
0x8b,0x2d,0xf0,0x51,0x8a,0x6f,0x13,0x01,0xdf,0xb7,0xf6,0xca,0xcf,0xa4,0x6f,0x4e,
0xee,0xad,0xd1,0xb9,0xfc,0x9b,0x58,0x99,0x0f,0xaf,0xa6,0xc8,0x0a,0xf4,0xf4,0x85,
0xe1,0xed,0xad,0x84,0xc7,0x1f,0x3c,0xcb,0xb5,0xd2,0x5c,0xa0,0x04,0x4f,0x8a,0x46,
0x87,0xab,0x30,0x79,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9a,0x76,0xf1,0x62,0xd8,
0x7c,0x81,0x2d,0x03,0xf6,0xf0,0x6b,0x9a,0x1f,0xd1,0x69,0x04,0x60,0x4a,0x3a,0x07,
0x15,0x1d,0x18,0x6f,0xf6,0x9b,0xe2,0x5d,0x3a,0x0b,0xe3,0xc7,0x4a,0xc3,0xd0,0x22,
0x29,0x4f,0xef,0x47,0xc4,0x0b,0xb7,0x77,0xec,0xc8,0x30,0x5f,0x0e,0xf5,0x9a,0xa3,
0x24,0x69,0x66,0x8c,0x35,0x76,0xdd,0xd6,0x26,0xd1,0x7c,0x7d,0xaf,0xeb,0x73,0x66,
0x02,0x71,0xc4,0x54,0x06,0xd1,0x57,0x95,0x1f,0x18,0xa3,0x00,0x92,0x9c,0xdf,0xf4,
0x51,0xf2,0x7a,0x5a,0x9d,0xe5,0xbe,0xff,0xc7,0x02,0x65,0xff,0xea,0x4f,0xdb,0x41,
0x47,0xd5,0xa1,0x5b,0x11,0x93,0xf8,0xd6,0x28,0xb6,0x4d,0xa6,0x0c,0x30,0x35,0x02,
0x01,0x01,0x04,0x30,0x29,0x92,0x92,0xf0,0x19,0xa9,0xaf,0x5e,0x00,0xf0,0xb4,0xb2,
0x04,0x03,0xea,0x93,0x54,0x80,0xb7,0xa2,0x02,0x64,0x6f,0x3b,0xd3,0x00,0x85,0x09,
0xdc,0x75,0x2f,0x89,0x5f,0xe0,0x67,0x5c,0x81,0x55,0xd8,0x14,0x1e,0x72,0x47,0xf8,
0x62,0x18,0x14,0x0a,0x30,0x65,0x02,0x01,0x01,0x04,0x60,0x8f,0x49,0x88,0xfe,0x68,
0xff,0xa2,0x4a,0xc9,0x20,0x6b,0x48,0xb7,0x43,0xe2,0xed,0x6e,0x77,0xd1,0xd2,0xc0,
0xed,0xad,0x37,0x9b,0x21,0x51,0xd8,0x9c,0xf1,0xad,0xc0,0xf0,0xc5,0x72,0x00,0x77,
0x04,0x92,0xe4,0x9a,0x50,0x1f,0x00,0xd5,0x52,0x8d,0x50,0x6f,0x8b,0x1e,0x81,0x8b,
0xb5,0xb1,0x37,0xbc,0xb4,0xf0,0xf3,0x9e,0x90,0xf3,0x59,0x52,0xef,0xed,0x78,0xa9,
0x3c,0xa9,0x59,0xe4,0x43,0xc5,0x78,0x13,0xa5,0x50,0x02,0xef,0x1d,0x74,0xc5,0x90,
0xa5,0xae,0x3d,0x99,0x72,0x39,0x51,0x31,0x42,0x0e,0x8e
};

static const guint8 data_broken_sequence_header[] = {
0x31,0x82,0x01,0xd7,0x02,0x01,0x01,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9a,0x76,
/* ^ damage (not a sequence tag) */
0xf1,0x62,0xd8,0x7c,0x81,0x2d,0x03,0xf6,0xf0,0x6b,0x9a,0x1f,0xd1,0x69,0x30,0x82,
0x01,0x1b,0x02,0x01,0x01,0x30,0x81,0x9a,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9b,
0xf5,0xc4,0xeb,0xc2,0xf0,0xa0,0x2b,0xde,0xf6,0x37,0x63,0xf6,0x0c,0x30,0x2c,0x04,
0x81,0x80,0x89,0x05,0xd7,0x16,0xe3,0x8d,0x9c,0x88,0x57,0x13,0x10,0xe9,0xb7,0xa0,
0x95,0x91,0x1f,0x85,0xa9,0xa1,0x05,0x63,0x4f,0x04,0x9d,0xa7,0x8f,0x32,0x85,0x6c,
0xb6,0x34,0x23,0x4d,0xa2,0x1a,0xa4,0x07,0xa2,0x03,0x39,0x6a,0xf4,0xbf,0x13,0xf1,
0xa6,0x7d,0xb4,0x38,0xe8,0x5d,0xc7,0x3e,0xfd,0xe5,0x28,0xe0,0xca,0xce,0xf7,0xdf,
0x2d,0xd8,0x5f,0x03,0xed,0x8c,0x96,0xe8,0x1f,0xab,0x4e,0x8e,0xab,0xb8,0x53,0x34,
0x8b,0x2d,0xf0,0x51,0x8a,0x6f,0x13,0x01,0xdf,0xb7,0xf6,0xca,0xcf,0xa4,0x6f,0x4e,
0xee,0xad,0xd1,0xb9,0xfc,0x9b,0x58,0x99,0x0f,0xaf,0xa6,0xc8,0x0a,0xf4,0xf4,0x85,
0xe1,0xed,0xad,0x84,0xc7,0x1f,0x3c,0xcb,0xb5,0xd2,0x5c,0xa0,0x04,0x4f,0x8a,0x46,
0x87,0xab,0x30,0x79,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9a,0x76,0xf1,0x62,0xd8,
0x7c,0x81,0x2d,0x03,0xf6,0xf0,0x6b,0x9a,0x1f,0xd1,0x69,0x04,0x60,0x4a,0x3a,0x07,
0x15,0x1d,0x18,0x6f,0xf6,0x9b,0xe2,0x5d,0x3a,0x0b,0xe3,0xc7,0x4a,0xc3,0xd0,0x22,
0x29,0x4f,0xef,0x47,0xc4,0x0b,0xb7,0x77,0xec,0xc8,0x30,0x5f,0x0e,0xf5,0x9a,0xa3,
0x24,0x69,0x66,0x8c,0x35,0x76,0xdd,0xd6,0x26,0xd1,0x7c,0x7d,0xaf,0xeb,0x73,0x66,
0x02,0x71,0xc4,0x54,0x06,0xd1,0x57,0x95,0x1f,0x18,0xa3,0x00,0x92,0x9c,0xdf,0xf4,
0x51,0xf2,0x7a,0x5a,0x9d,0xe5,0xbe,0xff,0xc7,0x02,0x65,0xff,0xea,0x4f,0xdb,0x41,
0x47,0xd5,0xa1,0x5b,0x11,0x93,0xf8,0xd6,0x28,0xb6,0x4d,0xa6,0x0c,0x30,0x35,0x02,
0x01,0x01,0x04,0x30,0x29,0x92,0x92,0xf0,0x19,0xa9,0xaf,0x5e,0x00,0xf0,0xb4,0xb2,
0x04,0x03,0xea,0x93,0x54,0x80,0xb7,0xa2,0x02,0x64,0x6f,0x3b,0xd3,0x00,0x85,0x09,
0xdc,0x75,0x2f,0x89,0x5f,0xe0,0x67,0x5c,0x81,0x55,0xd8,0x14,0x1e,0x72,0x47,0xf8,
0x62,0x18,0x14,0x0a,0x30,0x65,0x02,0x01,0x01,0x04,0x60,0x8f,0x49,0x88,0xfe,0x68,
0xff,0xa2,0x4a,0xc9,0x20,0x6b,0x48,0xb7,0x43,0xe2,0xed,0x6e,0x77,0xd1,0xd2,0xc0,
0xed,0xad,0x37,0x9b,0x21,0x51,0xd8,0x9c,0xf1,0xad,0xc0,0xf0,0xc5,0x72,0x00,0x77,
0x04,0x92,0xe4,0x9a,0x50,0x1f,0x00,0xd5,0x52,0x8d,0x50,0x6f,0x8b,0x1e,0x81,0x8b,
0xb5,0xb1,0x37,0xbc,0xb4,0xf0,0xf3,0x9e,0x90,0xf3,0x59,0x52,0xef,0xed,0x78,0xa9,
0x3c,0xa9,0x59,0xe4,0x43,0xc5,0x78,0x13,0xa5,0x50,0x02,0xef,0x1d,0x74,0xc5,0x90,
0xa5,0xae,0x3d,0x99,0x72,0x39,0x51,0x31,0x42,0x0e,0x8e
};

static const guint8 data_broken_format_version[] = {
0x30,0x82,0x01,0xd7,0x03,0x01,0x01,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9a,0x76,
/*                     ^ damage (version is not an integer) */
0xf1,0x62,0xd8,0x7c,0x81,0x2d,0x03,0xf6,0xf0,0x6b,0x9a,0x1f,0xd1,0x69,0x30,0x82,
0x01,0x1b,0x02,0x01,0x01,0x30,0x81,0x9a,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9b,
0xf5,0xc4,0xeb,0xc2,0xf0,0xa0,0x2b,0xde,0xf6,0x37,0x63,0xf6,0x0c,0x30,0x2c,0x04,
0x81,0x80,0x89,0x05,0xd7,0x16,0xe3,0x8d,0x9c,0x88,0x57,0x13,0x10,0xe9,0xb7,0xa0,
0x95,0x91,0x1f,0x85,0xa9,0xa1,0x05,0x63,0x4f,0x04,0x9d,0xa7,0x8f,0x32,0x85,0x6c,
0xb6,0x34,0x23,0x4d,0xa2,0x1a,0xa4,0x07,0xa2,0x03,0x39,0x6a,0xf4,0xbf,0x13,0xf1,
0xa6,0x7d,0xb4,0x38,0xe8,0x5d,0xc7,0x3e,0xfd,0xe5,0x28,0xe0,0xca,0xce,0xf7,0xdf,
0x2d,0xd8,0x5f,0x03,0xed,0x8c,0x96,0xe8,0x1f,0xab,0x4e,0x8e,0xab,0xb8,0x53,0x34,
0x8b,0x2d,0xf0,0x51,0x8a,0x6f,0x13,0x01,0xdf,0xb7,0xf6,0xca,0xcf,0xa4,0x6f,0x4e,
0xee,0xad,0xd1,0xb9,0xfc,0x9b,0x58,0x99,0x0f,0xaf,0xa6,0xc8,0x0a,0xf4,0xf4,0x85,
0xe1,0xed,0xad,0x84,0xc7,0x1f,0x3c,0xcb,0xb5,0xd2,0x5c,0xa0,0x04,0x4f,0x8a,0x46,
0x87,0xab,0x30,0x79,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9a,0x76,0xf1,0x62,0xd8,
0x7c,0x81,0x2d,0x03,0xf6,0xf0,0x6b,0x9a,0x1f,0xd1,0x69,0x04,0x60,0x4a,0x3a,0x07,
0x15,0x1d,0x18,0x6f,0xf6,0x9b,0xe2,0x5d,0x3a,0x0b,0xe3,0xc7,0x4a,0xc3,0xd0,0x22,
0x29,0x4f,0xef,0x47,0xc4,0x0b,0xb7,0x77,0xec,0xc8,0x30,0x5f,0x0e,0xf5,0x9a,0xa3,
0x24,0x69,0x66,0x8c,0x35,0x76,0xdd,0xd6,0x26,0xd1,0x7c,0x7d,0xaf,0xeb,0x73,0x66,
0x02,0x71,0xc4,0x54,0x06,0xd1,0x57,0x95,0x1f,0x18,0xa3,0x00,0x92,0x9c,0xdf,0xf4,
0x51,0xf2,0x7a,0x5a,0x9d,0xe5,0xbe,0xff,0xc7,0x02,0x65,0xff,0xea,0x4f,0xdb,0x41,
0x47,0xd5,0xa1,0x5b,0x11,0x93,0xf8,0xd6,0x28,0xb6,0x4d,0xa6,0x0c,0x30,0x35,0x02,
0x01,0x01,0x04,0x30,0x29,0x92,0x92,0xf0,0x19,0xa9,0xaf,0x5e,0x00,0xf0,0xb4,0xb2,
0x04,0x03,0xea,0x93,0x54,0x80,0xb7,0xa2,0x02,0x64,0x6f,0x3b,0xd3,0x00,0x85,0x09,
0xdc,0x75,0x2f,0x89,0x5f,0xe0,0x67,0x5c,0x81,0x55,0xd8,0x14,0x1e,0x72,0x47,0xf8,
0x62,0x18,0x14,0x0a,0x30,0x65,0x02,0x01,0x01,0x04,0x60,0x8f,0x49,0x88,0xfe,0x68,
0xff,0xa2,0x4a,0xc9,0x20,0x6b,0x48,0xb7,0x43,0xe2,0xed,0x6e,0x77,0xd1,0xd2,0xc0,
0xed,0xad,0x37,0x9b,0x21,0x51,0xd8,0x9c,0xf1,0xad,0xc0,0xf0,0xc5,0x72,0x00,0x77,
0x04,0x92,0xe4,0x9a,0x50,0x1f,0x00,0xd5,0x52,0x8d,0x50,0x6f,0x8b,0x1e,0x81,0x8b,
0xb5,0xb1,0x37,0xbc,0xb4,0xf0,0xf3,0x9e,0x90,0xf3,0x59,0x52,0xef,0xed,0x78,0xa9,
0x3c,0xa9,0x59,0xe4,0x43,0xc5,0x78,0x13,0xa5,0x50,0x02,0xef,0x1d,0x74,0xc5,0x90,
0xa5,0xae,0x3d,0x99,0x72,0x39,0x51,0x31,0x42,0x0e,0x8e
};

static const guint8 data_invalid_format_version[] = {
0x30,0x82,0x01,0xd7,0x02,0x01,0xff,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9a,0x76,
/*                              ^^ damage (version = -1) */
0xf1,0x62,0xd8,0x7c,0x81,0x2d,0x03,0xf6,0xf0,0x6b,0x9a,0x1f,0xd1,0x69,0x30,0x82,
0x01,0x1b,0x02,0x01,0x01,0x30,0x81,0x9a,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9b,
0xf5,0xc4,0xeb,0xc2,0xf0,0xa0,0x2b,0xde,0xf6,0x37,0x63,0xf6,0x0c,0x30,0x2c,0x04,
0x81,0x80,0x89,0x05,0xd7,0x16,0xe3,0x8d,0x9c,0x88,0x57,0x13,0x10,0xe9,0xb7,0xa0,
0x95,0x91,0x1f,0x85,0xa9,0xa1,0x05,0x63,0x4f,0x04,0x9d,0xa7,0x8f,0x32,0x85,0x6c,
0xb6,0x34,0x23,0x4d,0xa2,0x1a,0xa4,0x07,0xa2,0x03,0x39,0x6a,0xf4,0xbf,0x13,0xf1,
0xa6,0x7d,0xb4,0x38,0xe8,0x5d,0xc7,0x3e,0xfd,0xe5,0x28,0xe0,0xca,0xce,0xf7,0xdf,
0x2d,0xd8,0x5f,0x03,0xed,0x8c,0x96,0xe8,0x1f,0xab,0x4e,0x8e,0xab,0xb8,0x53,0x34,
0x8b,0x2d,0xf0,0x51,0x8a,0x6f,0x13,0x01,0xdf,0xb7,0xf6,0xca,0xcf,0xa4,0x6f,0x4e,
0xee,0xad,0xd1,0xb9,0xfc,0x9b,0x58,0x99,0x0f,0xaf,0xa6,0xc8,0x0a,0xf4,0xf4,0x85,
0xe1,0xed,0xad,0x84,0xc7,0x1f,0x3c,0xcb,0xb5,0xd2,0x5c,0xa0,0x04,0x4f,0x8a,0x46,
0x87,0xab,0x30,0x79,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9a,0x76,0xf1,0x62,0xd8,
0x7c,0x81,0x2d,0x03,0xf6,0xf0,0x6b,0x9a,0x1f,0xd1,0x69,0x04,0x60,0x4a,0x3a,0x07,
0x15,0x1d,0x18,0x6f,0xf6,0x9b,0xe2,0x5d,0x3a,0x0b,0xe3,0xc7,0x4a,0xc3,0xd0,0x22,
0x29,0x4f,0xef,0x47,0xc4,0x0b,0xb7,0x77,0xec,0xc8,0x30,0x5f,0x0e,0xf5,0x9a,0xa3,
0x24,0x69,0x66,0x8c,0x35,0x76,0xdd,0xd6,0x26,0xd1,0x7c,0x7d,0xaf,0xeb,0x73,0x66,
0x02,0x71,0xc4,0x54,0x06,0xd1,0x57,0x95,0x1f,0x18,0xa3,0x00,0x92,0x9c,0xdf,0xf4,
0x51,0xf2,0x7a,0x5a,0x9d,0xe5,0xbe,0xff,0xc7,0x02,0x65,0xff,0xea,0x4f,0xdb,0x41,
0x47,0xd5,0xa1,0x5b,0x11,0x93,0xf8,0xd6,0x28,0xb6,0x4d,0xa6,0x0c,0x30,0x35,0x02,
0x01,0x01,0x04,0x30,0x29,0x92,0x92,0xf0,0x19,0xa9,0xaf,0x5e,0x00,0xf0,0xb4,0xb2,
0x04,0x03,0xea,0x93,0x54,0x80,0xb7,0xa2,0x02,0x64,0x6f,0x3b,0xd3,0x00,0x85,0x09,
0xdc,0x75,0x2f,0x89,0x5f,0xe0,0x67,0x5c,0x81,0x55,0xd8,0x14,0x1e,0x72,0x47,0xf8,
0x62,0x18,0x14,0x0a,0x30,0x65,0x02,0x01,0x01,0x04,0x60,0x8f,0x49,0x88,0xfe,0x68,
0xff,0xa2,0x4a,0xc9,0x20,0x6b,0x48,0xb7,0x43,0xe2,0xed,0x6e,0x77,0xd1,0xd2,0xc0,
0xed,0xad,0x37,0x9b,0x21,0x51,0xd8,0x9c,0xf1,0xad,0xc0,0xf0,0xc5,0x72,0x00,0x77,
0x04,0x92,0xe4,0x9a,0x50,0x1f,0x00,0xd5,0x52,0x8d,0x50,0x6f,0x8b,0x1e,0x81,0x8b,
0xb5,0xb1,0x37,0xbc,0xb4,0xf0,0xf3,0x9e,0x90,0xf3,0x59,0x52,0xef,0xed,0x78,0xa9,
0x3c,0xa9,0x59,0xe4,0x43,0xc5,0x78,0x13,0xa5,0x50,0x02,0xef,0x1d,0x74,0xc5,0x90,
0xa5,0xae,0x3d,0x99,0x72,0x39,0x51,0x31,0x42,0x0e,0x8e
};

static const guint8 data_broken_sender_key[] = {
0x30,0x82,0x01,0xd7,0x02,0x01,0x01,0x32,0x15,0x02,0x01,0x01,0x04,0x10,0x9a,0x76,
/*                                    ^ damage (not a sequence tag) */
0xf1,0x62,0xd8,0x7c,0x81,0x2d,0x03,0xf6,0xf0,0x6b,0x9a,0x1f,0xd1,0x69,0x30,0x82,
0x01,0x1b,0x02,0x01,0x01,0x30,0x81,0x9a,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9b,
0xf5,0xc4,0xeb,0xc2,0xf0,0xa0,0x2b,0xde,0xf6,0x37,0x63,0xf6,0x0c,0x30,0x2c,0x04,
0x81,0x80,0x89,0x05,0xd7,0x16,0xe3,0x8d,0x9c,0x88,0x57,0x13,0x10,0xe9,0xb7,0xa0,
0x95,0x91,0x1f,0x85,0xa9,0xa1,0x05,0x63,0x4f,0x04,0x9d,0xa7,0x8f,0x32,0x85,0x6c,
0xb6,0x34,0x23,0x4d,0xa2,0x1a,0xa4,0x07,0xa2,0x03,0x39,0x6a,0xf4,0xbf,0x13,0xf1,
0xa6,0x7d,0xb4,0x38,0xe8,0x5d,0xc7,0x3e,0xfd,0xe5,0x28,0xe0,0xca,0xce,0xf7,0xdf,
0x2d,0xd8,0x5f,0x03,0xed,0x8c,0x96,0xe8,0x1f,0xab,0x4e,0x8e,0xab,0xb8,0x53,0x34,
0x8b,0x2d,0xf0,0x51,0x8a,0x6f,0x13,0x01,0xdf,0xb7,0xf6,0xca,0xcf,0xa4,0x6f,0x4e,
0xee,0xad,0xd1,0xb9,0xfc,0x9b,0x58,0x99,0x0f,0xaf,0xa6,0xc8,0x0a,0xf4,0xf4,0x85,
0xe1,0xed,0xad,0x84,0xc7,0x1f,0x3c,0xcb,0xb5,0xd2,0x5c,0xa0,0x04,0x4f,0x8a,0x46,
0x87,0xab,0x30,0x79,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9a,0x76,0xf1,0x62,0xd8,
0x7c,0x81,0x2d,0x03,0xf6,0xf0,0x6b,0x9a,0x1f,0xd1,0x69,0x04,0x60,0x4a,0x3a,0x07,
0x15,0x1d,0x18,0x6f,0xf6,0x9b,0xe2,0x5d,0x3a,0x0b,0xe3,0xc7,0x4a,0xc3,0xd0,0x22,
0x29,0x4f,0xef,0x47,0xc4,0x0b,0xb7,0x77,0xec,0xc8,0x30,0x5f,0x0e,0xf5,0x9a,0xa3,
0x24,0x69,0x66,0x8c,0x35,0x76,0xdd,0xd6,0x26,0xd1,0x7c,0x7d,0xaf,0xeb,0x73,0x66,
0x02,0x71,0xc4,0x54,0x06,0xd1,0x57,0x95,0x1f,0x18,0xa3,0x00,0x92,0x9c,0xdf,0xf4,
0x51,0xf2,0x7a,0x5a,0x9d,0xe5,0xbe,0xff,0xc7,0x02,0x65,0xff,0xea,0x4f,0xdb,0x41,
0x47,0xd5,0xa1,0x5b,0x11,0x93,0xf8,0xd6,0x28,0xb6,0x4d,0xa6,0x0c,0x30,0x35,0x02,
0x01,0x01,0x04,0x30,0x29,0x92,0x92,0xf0,0x19,0xa9,0xaf,0x5e,0x00,0xf0,0xb4,0xb2,
0x04,0x03,0xea,0x93,0x54,0x80,0xb7,0xa2,0x02,0x64,0x6f,0x3b,0xd3,0x00,0x85,0x09,
0xdc,0x75,0x2f,0x89,0x5f,0xe0,0x67,0x5c,0x81,0x55,0xd8,0x14,0x1e,0x72,0x47,0xf8,
0x62,0x18,0x14,0x0a,0x30,0x65,0x02,0x01,0x01,0x04,0x60,0x8f,0x49,0x88,0xfe,0x68,
0xff,0xa2,0x4a,0xc9,0x20,0x6b,0x48,0xb7,0x43,0xe2,0xed,0x6e,0x77,0xd1,0xd2,0xc0,
0xed,0xad,0x37,0x9b,0x21,0x51,0xd8,0x9c,0xf1,0xad,0xc0,0xf0,0xc5,0x72,0x00,0x77,
0x04,0x92,0xe4,0x9a,0x50,0x1f,0x00,0xd5,0x52,0x8d,0x50,0x6f,0x8b,0x1e,0x81,0x8b,
0xb5,0xb1,0x37,0xbc,0xb4,0xf0,0xf3,0x9e,0x90,0xf3,0x59,0x52,0xef,0xed,0x78,0xa9,
0x3c,0xa9,0x59,0xe4,0x43,0xc5,0x78,0x13,0xa5,0x50,0x02,0xef,0x1d,0x74,0xc5,0x90,
0xa5,0xae,0x3d,0x99,0x72,0x39,0x51,0x31,0x42,0x0e,0x8e
};

static const guint8 data_invalid_sender_key_format[] = {
0x30,0x82,0x01,0xd7,0x02,0x01,0x01,0x30,0x15,0x02,0x01,0xff,0x04,0x10,0x9a,0x76,
/*                                  damage (format = -1) ^^ */
0xf1,0x62,0xd8,0x7c,0x81,0x2d,0x03,0xf6,0xf0,0x6b,0x9a,0x1f,0xd1,0x69,0x30,0x82,
0x01,0x1b,0x02,0x01,0x01,0x30,0x81,0x9a,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9b,
0xf5,0xc4,0xeb,0xc2,0xf0,0xa0,0x2b,0xde,0xf6,0x37,0x63,0xf6,0x0c,0x30,0x2c,0x04,
0x81,0x80,0x89,0x05,0xd7,0x16,0xe3,0x8d,0x9c,0x88,0x57,0x13,0x10,0xe9,0xb7,0xa0,
0x95,0x91,0x1f,0x85,0xa9,0xa1,0x05,0x63,0x4f,0x04,0x9d,0xa7,0x8f,0x32,0x85,0x6c,
0xb6,0x34,0x23,0x4d,0xa2,0x1a,0xa4,0x07,0xa2,0x03,0x39,0x6a,0xf4,0xbf,0x13,0xf1,
0xa6,0x7d,0xb4,0x38,0xe8,0x5d,0xc7,0x3e,0xfd,0xe5,0x28,0xe0,0xca,0xce,0xf7,0xdf,
0x2d,0xd8,0x5f,0x03,0xed,0x8c,0x96,0xe8,0x1f,0xab,0x4e,0x8e,0xab,0xb8,0x53,0x34,
0x8b,0x2d,0xf0,0x51,0x8a,0x6f,0x13,0x01,0xdf,0xb7,0xf6,0xca,0xcf,0xa4,0x6f,0x4e,
0xee,0xad,0xd1,0xb9,0xfc,0x9b,0x58,0x99,0x0f,0xaf,0xa6,0xc8,0x0a,0xf4,0xf4,0x85,
0xe1,0xed,0xad,0x84,0xc7,0x1f,0x3c,0xcb,0xb5,0xd2,0x5c,0xa0,0x04,0x4f,0x8a,0x46,
0x87,0xab,0x30,0x79,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9a,0x76,0xf1,0x62,0xd8,
0x7c,0x81,0x2d,0x03,0xf6,0xf0,0x6b,0x9a,0x1f,0xd1,0x69,0x04,0x60,0x4a,0x3a,0x07,
0x15,0x1d,0x18,0x6f,0xf6,0x9b,0xe2,0x5d,0x3a,0x0b,0xe3,0xc7,0x4a,0xc3,0xd0,0x22,
0x29,0x4f,0xef,0x47,0xc4,0x0b,0xb7,0x77,0xec,0xc8,0x30,0x5f,0x0e,0xf5,0x9a,0xa3,
0x24,0x69,0x66,0x8c,0x35,0x76,0xdd,0xd6,0x26,0xd1,0x7c,0x7d,0xaf,0xeb,0x73,0x66,
0x02,0x71,0xc4,0x54,0x06,0xd1,0x57,0x95,0x1f,0x18,0xa3,0x00,0x92,0x9c,0xdf,0xf4,
0x51,0xf2,0x7a,0x5a,0x9d,0xe5,0xbe,0xff,0xc7,0x02,0x65,0xff,0xea,0x4f,0xdb,0x41,
0x47,0xd5,0xa1,0x5b,0x11,0x93,0xf8,0xd6,0x28,0xb6,0x4d,0xa6,0x0c,0x30,0x35,0x02,
0x01,0x01,0x04,0x30,0x29,0x92,0x92,0xf0,0x19,0xa9,0xaf,0x5e,0x00,0xf0,0xb4,0xb2,
0x04,0x03,0xea,0x93,0x54,0x80,0xb7,0xa2,0x02,0x64,0x6f,0x3b,0xd3,0x00,0x85,0x09,
0xdc,0x75,0x2f,0x89,0x5f,0xe0,0x67,0x5c,0x81,0x55,0xd8,0x14,0x1e,0x72,0x47,0xf8,
0x62,0x18,0x14,0x0a,0x30,0x65,0x02,0x01,0x01,0x04,0x60,0x8f,0x49,0x88,0xfe,0x68,
0xff,0xa2,0x4a,0xc9,0x20,0x6b,0x48,0xb7,0x43,0xe2,0xed,0x6e,0x77,0xd1,0xd2,0xc0,
0xed,0xad,0x37,0x9b,0x21,0x51,0xd8,0x9c,0xf1,0xad,0xc0,0xf0,0xc5,0x72,0x00,0x77,
0x04,0x92,0xe4,0x9a,0x50,0x1f,0x00,0xd5,0x52,0x8d,0x50,0x6f,0x8b,0x1e,0x81,0x8b,
0xb5,0xb1,0x37,0xbc,0xb4,0xf0,0xf3,0x9e,0x90,0xf3,0x59,0x52,0xef,0xed,0x78,0xa9,
0x3c,0xa9,0x59,0xe4,0x43,0xc5,0x78,0x13,0xa5,0x50,0x02,0xef,0x1d,0x74,0xc5,0x90,
0xa5,0xae,0x3d,0x99,0x72,0x39,0x51,0x31,0x42,0x0e,0x8e
};

static const guint8 data_broken_encrypted_key_header[] = {
0x30,0x82,0x01,0xd7,0x02,0x01,0x01,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9a,0x76,
0xf1,0x62,0xd8,0x7c,0x81,0x2d,0x03,0xf6,0xf0,0x6b,0x9a,0x1f,0xd1,0x69,0x33,0x82,
/*                                           damage (not a sequence tag) ^ */
0x01,0x1b,0x02,0x01,0x01,0x30,0x81,0x9a,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9b,
0xf5,0xc4,0xeb,0xc2,0xf0,0xa0,0x2b,0xde,0xf6,0x37,0x63,0xf6,0x0c,0x30,0x2c,0x04,
0x81,0x80,0x89,0x05,0xd7,0x16,0xe3,0x8d,0x9c,0x88,0x57,0x13,0x10,0xe9,0xb7,0xa0,
0x95,0x91,0x1f,0x85,0xa9,0xa1,0x05,0x63,0x4f,0x04,0x9d,0xa7,0x8f,0x32,0x85,0x6c,
0xb6,0x34,0x23,0x4d,0xa2,0x1a,0xa4,0x07,0xa2,0x03,0x39,0x6a,0xf4,0xbf,0x13,0xf1,
0xa6,0x7d,0xb4,0x38,0xe8,0x5d,0xc7,0x3e,0xfd,0xe5,0x28,0xe0,0xca,0xce,0xf7,0xdf,
0x2d,0xd8,0x5f,0x03,0xed,0x8c,0x96,0xe8,0x1f,0xab,0x4e,0x8e,0xab,0xb8,0x53,0x34,
0x8b,0x2d,0xf0,0x51,0x8a,0x6f,0x13,0x01,0xdf,0xb7,0xf6,0xca,0xcf,0xa4,0x6f,0x4e,
0xee,0xad,0xd1,0xb9,0xfc,0x9b,0x58,0x99,0x0f,0xaf,0xa6,0xc8,0x0a,0xf4,0xf4,0x85,
0xe1,0xed,0xad,0x84,0xc7,0x1f,0x3c,0xcb,0xb5,0xd2,0x5c,0xa0,0x04,0x4f,0x8a,0x46,
0x87,0xab,0x30,0x79,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9a,0x76,0xf1,0x62,0xd8,
0x7c,0x81,0x2d,0x03,0xf6,0xf0,0x6b,0x9a,0x1f,0xd1,0x69,0x04,0x60,0x4a,0x3a,0x07,
0x15,0x1d,0x18,0x6f,0xf6,0x9b,0xe2,0x5d,0x3a,0x0b,0xe3,0xc7,0x4a,0xc3,0xd0,0x22,
0x29,0x4f,0xef,0x47,0xc4,0x0b,0xb7,0x77,0xec,0xc8,0x30,0x5f,0x0e,0xf5,0x9a,0xa3,
0x24,0x69,0x66,0x8c,0x35,0x76,0xdd,0xd6,0x26,0xd1,0x7c,0x7d,0xaf,0xeb,0x73,0x66,
0x02,0x71,0xc4,0x54,0x06,0xd1,0x57,0x95,0x1f,0x18,0xa3,0x00,0x92,0x9c,0xdf,0xf4,
0x51,0xf2,0x7a,0x5a,0x9d,0xe5,0xbe,0xff,0xc7,0x02,0x65,0xff,0xea,0x4f,0xdb,0x41,
0x47,0xd5,0xa1,0x5b,0x11,0x93,0xf8,0xd6,0x28,0xb6,0x4d,0xa6,0x0c,0x30,0x35,0x02,
0x01,0x01,0x04,0x30,0x29,0x92,0x92,0xf0,0x19,0xa9,0xaf,0x5e,0x00,0xf0,0xb4,0xb2,
0x04,0x03,0xea,0x93,0x54,0x80,0xb7,0xa2,0x02,0x64,0x6f,0x3b,0xd3,0x00,0x85,0x09,
0xdc,0x75,0x2f,0x89,0x5f,0xe0,0x67,0x5c,0x81,0x55,0xd8,0x14,0x1e,0x72,0x47,0xf8,
0x62,0x18,0x14,0x0a,0x30,0x65,0x02,0x01,0x01,0x04,0x60,0x8f,0x49,0x88,0xfe,0x68,
0xff,0xa2,0x4a,0xc9,0x20,0x6b,0x48,0xb7,0x43,0xe2,0xed,0x6e,0x77,0xd1,0xd2,0xc0,
0xed,0xad,0x37,0x9b,0x21,0x51,0xd8,0x9c,0xf1,0xad,0xc0,0xf0,0xc5,0x72,0x00,0x77,
0x04,0x92,0xe4,0x9a,0x50,0x1f,0x00,0xd5,0x52,0x8d,0x50,0x6f,0x8b,0x1e,0x81,0x8b,
0xb5,0xb1,0x37,0xbc,0xb4,0xf0,0xf3,0x9e,0x90,0xf3,0x59,0x52,0xef,0xed,0x78,0xa9,
0x3c,0xa9,0x59,0xe4,0x43,0xc5,0x78,0x13,0xa5,0x50,0x02,0xef,0x1d,0x74,0xc5,0x90,
0xa5,0xae,0x3d,0x99,0x72,0x39,0x51,0x31,0x42,0x0e,0x8e
};

static const guint8 data_broken_encrypted_key_type[] = {
0x30,0x82,0x01,0xd7,0x02,0x01,0x01,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9a,0x76,
0xf1,0x62,0xd8,0x7c,0x81,0x2d,0x03,0xf6,0xf0,0x6b,0x9a,0x1f,0xd1,0x69,0x30,0x82,
0x01,0x1b,0x03,0x01,0x01,0x30,0x81,0x9a,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9b,
/*           ^ damage (format is not an integer) */
0xf5,0xc4,0xeb,0xc2,0xf0,0xa0,0x2b,0xde,0xf6,0x37,0x63,0xf6,0x0c,0x30,0x2c,0x04,
0x81,0x80,0x89,0x05,0xd7,0x16,0xe3,0x8d,0x9c,0x88,0x57,0x13,0x10,0xe9,0xb7,0xa0,
0x95,0x91,0x1f,0x85,0xa9,0xa1,0x05,0x63,0x4f,0x04,0x9d,0xa7,0x8f,0x32,0x85,0x6c,
0xb6,0x34,0x23,0x4d,0xa2,0x1a,0xa4,0x07,0xa2,0x03,0x39,0x6a,0xf4,0xbf,0x13,0xf1,
0xa6,0x7d,0xb4,0x38,0xe8,0x5d,0xc7,0x3e,0xfd,0xe5,0x28,0xe0,0xca,0xce,0xf7,0xdf,
0x2d,0xd8,0x5f,0x03,0xed,0x8c,0x96,0xe8,0x1f,0xab,0x4e,0x8e,0xab,0xb8,0x53,0x34,
0x8b,0x2d,0xf0,0x51,0x8a,0x6f,0x13,0x01,0xdf,0xb7,0xf6,0xca,0xcf,0xa4,0x6f,0x4e,
0xee,0xad,0xd1,0xb9,0xfc,0x9b,0x58,0x99,0x0f,0xaf,0xa6,0xc8,0x0a,0xf4,0xf4,0x85,
0xe1,0xed,0xad,0x84,0xc7,0x1f,0x3c,0xcb,0xb5,0xd2,0x5c,0xa0,0x04,0x4f,0x8a,0x46,
0x87,0xab,0x30,0x79,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9a,0x76,0xf1,0x62,0xd8,
0x7c,0x81,0x2d,0x03,0xf6,0xf0,0x6b,0x9a,0x1f,0xd1,0x69,0x04,0x60,0x4a,0x3a,0x07,
0x15,0x1d,0x18,0x6f,0xf6,0x9b,0xe2,0x5d,0x3a,0x0b,0xe3,0xc7,0x4a,0xc3,0xd0,0x22,
0x29,0x4f,0xef,0x47,0xc4,0x0b,0xb7,0x77,0xec,0xc8,0x30,0x5f,0x0e,0xf5,0x9a,0xa3,
0x24,0x69,0x66,0x8c,0x35,0x76,0xdd,0xd6,0x26,0xd1,0x7c,0x7d,0xaf,0xeb,0x73,0x66,
0x02,0x71,0xc4,0x54,0x06,0xd1,0x57,0x95,0x1f,0x18,0xa3,0x00,0x92,0x9c,0xdf,0xf4,
0x51,0xf2,0x7a,0x5a,0x9d,0xe5,0xbe,0xff,0xc7,0x02,0x65,0xff,0xea,0x4f,0xdb,0x41,
0x47,0xd5,0xa1,0x5b,0x11,0x93,0xf8,0xd6,0x28,0xb6,0x4d,0xa6,0x0c,0x30,0x35,0x02,
0x01,0x01,0x04,0x30,0x29,0x92,0x92,0xf0,0x19,0xa9,0xaf,0x5e,0x00,0xf0,0xb4,0xb2,
0x04,0x03,0xea,0x93,0x54,0x80,0xb7,0xa2,0x02,0x64,0x6f,0x3b,0xd3,0x00,0x85,0x09,
0xdc,0x75,0x2f,0x89,0x5f,0xe0,0x67,0x5c,0x81,0x55,0xd8,0x14,0x1e,0x72,0x47,0xf8,
0x62,0x18,0x14,0x0a,0x30,0x65,0x02,0x01,0x01,0x04,0x60,0x8f,0x49,0x88,0xfe,0x68,
0xff,0xa2,0x4a,0xc9,0x20,0x6b,0x48,0xb7,0x43,0xe2,0xed,0x6e,0x77,0xd1,0xd2,0xc0,
0xed,0xad,0x37,0x9b,0x21,0x51,0xd8,0x9c,0xf1,0xad,0xc0,0xf0,0xc5,0x72,0x00,0x77,
0x04,0x92,0xe4,0x9a,0x50,0x1f,0x00,0xd5,0x52,0x8d,0x50,0x6f,0x8b,0x1e,0x81,0x8b,
0xb5,0xb1,0x37,0xbc,0xb4,0xf0,0xf3,0x9e,0x90,0xf3,0x59,0x52,0xef,0xed,0x78,0xa9,
0x3c,0xa9,0x59,0xe4,0x43,0xc5,0x78,0x13,0xa5,0x50,0x02,0xef,0x1d,0x74,0xc5,0x90,
0xa5,0xae,0x3d,0x99,0x72,0x39,0x51,0x31,0x42,0x0e,0x8e
};

static const guint8 data_invalid_encrypted_key_type[] = {
0x30,0x82,0x01,0xd7,0x02,0x01,0x01,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9a,0x76,
0xf1,0x62,0xd8,0x7c,0x81,0x2d,0x03,0xf6,0xf0,0x6b,0x9a,0x1f,0xd1,0x69,0x30,0x82,
0x01,0x1b,0x02,0x01,0xff,0x30,0x81,0x9a,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9b,
/*                    ^^ damage (format = -1) */
0xf5,0xc4,0xeb,0xc2,0xf0,0xa0,0x2b,0xde,0xf6,0x37,0x63,0xf6,0x0c,0x30,0x2c,0x04,
0x81,0x80,0x89,0x05,0xd7,0x16,0xe3,0x8d,0x9c,0x88,0x57,0x13,0x10,0xe9,0xb7,0xa0,
0x95,0x91,0x1f,0x85,0xa9,0xa1,0x05,0x63,0x4f,0x04,0x9d,0xa7,0x8f,0x32,0x85,0x6c,
0xb6,0x34,0x23,0x4d,0xa2,0x1a,0xa4,0x07,0xa2,0x03,0x39,0x6a,0xf4,0xbf,0x13,0xf1,
0xa6,0x7d,0xb4,0x38,0xe8,0x5d,0xc7,0x3e,0xfd,0xe5,0x28,0xe0,0xca,0xce,0xf7,0xdf,
0x2d,0xd8,0x5f,0x03,0xed,0x8c,0x96,0xe8,0x1f,0xab,0x4e,0x8e,0xab,0xb8,0x53,0x34,
0x8b,0x2d,0xf0,0x51,0x8a,0x6f,0x13,0x01,0xdf,0xb7,0xf6,0xca,0xcf,0xa4,0x6f,0x4e,
0xee,0xad,0xd1,0xb9,0xfc,0x9b,0x58,0x99,0x0f,0xaf,0xa6,0xc8,0x0a,0xf4,0xf4,0x85,
0xe1,0xed,0xad,0x84,0xc7,0x1f,0x3c,0xcb,0xb5,0xd2,0x5c,0xa0,0x04,0x4f,0x8a,0x46,
0x87,0xab,0x30,0x79,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9a,0x76,0xf1,0x62,0xd8,
0x7c,0x81,0x2d,0x03,0xf6,0xf0,0x6b,0x9a,0x1f,0xd1,0x69,0x04,0x60,0x4a,0x3a,0x07,
0x15,0x1d,0x18,0x6f,0xf6,0x9b,0xe2,0x5d,0x3a,0x0b,0xe3,0xc7,0x4a,0xc3,0xd0,0x22,
0x29,0x4f,0xef,0x47,0xc4,0x0b,0xb7,0x77,0xec,0xc8,0x30,0x5f,0x0e,0xf5,0x9a,0xa3,
0x24,0x69,0x66,0x8c,0x35,0x76,0xdd,0xd6,0x26,0xd1,0x7c,0x7d,0xaf,0xeb,0x73,0x66,
0x02,0x71,0xc4,0x54,0x06,0xd1,0x57,0x95,0x1f,0x18,0xa3,0x00,0x92,0x9c,0xdf,0xf4,
0x51,0xf2,0x7a,0x5a,0x9d,0xe5,0xbe,0xff,0xc7,0x02,0x65,0xff,0xea,0x4f,0xdb,0x41,
0x47,0xd5,0xa1,0x5b,0x11,0x93,0xf8,0xd6,0x28,0xb6,0x4d,0xa6,0x0c,0x30,0x35,0x02,
0x01,0x01,0x04,0x30,0x29,0x92,0x92,0xf0,0x19,0xa9,0xaf,0x5e,0x00,0xf0,0xb4,0xb2,
0x04,0x03,0xea,0x93,0x54,0x80,0xb7,0xa2,0x02,0x64,0x6f,0x3b,0xd3,0x00,0x85,0x09,
0xdc,0x75,0x2f,0x89,0x5f,0xe0,0x67,0x5c,0x81,0x55,0xd8,0x14,0x1e,0x72,0x47,0xf8,
0x62,0x18,0x14,0x0a,0x30,0x65,0x02,0x01,0x01,0x04,0x60,0x8f,0x49,0x88,0xfe,0x68,
0xff,0xa2,0x4a,0xc9,0x20,0x6b,0x48,0xb7,0x43,0xe2,0xed,0x6e,0x77,0xd1,0xd2,0xc0,
0xed,0xad,0x37,0x9b,0x21,0x51,0xd8,0x9c,0xf1,0xad,0xc0,0xf0,0xc5,0x72,0x00,0x77,
0x04,0x92,0xe4,0x9a,0x50,0x1f,0x00,0xd5,0x52,0x8d,0x50,0x6f,0x8b,0x1e,0x81,0x8b,
0xb5,0xb1,0x37,0xbc,0xb4,0xf0,0xf3,0x9e,0x90,0xf3,0x59,0x52,0xef,0xed,0x78,0xa9,
0x3c,0xa9,0x59,0xe4,0x43,0xc5,0x78,0x13,0xa5,0x50,0x02,0xef,0x1d,0x74,0xc5,0x90,
0xa5,0xae,0x3d,0x99,0x72,0x39,0x51,0x31,0x42,0x0e,0x8e
};

static const guint8 data_broken_fingerprint_sequence[] = {
0x30,0x82,0x01,0xd7,0x02,0x01,0x01,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9a,0x76,
0xf1,0x62,0xd8,0x7c,0x81,0x2d,0x03,0xf6,0xf0,0x6b,0x9a,0x1f,0xd1,0x69,0x30,0x82,
0x01,0x1b,0x02,0x01,0x01,0x33,0x81,0x9a,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9b,
/*                          ^ damage (not a sequence tag) */
0xf5,0xc4,0xeb,0xc2,0xf0,0xa0,0x2b,0xde,0xf6,0x37,0x63,0xf6,0x0c,0x30,0x2c,0x04,
0x81,0x80,0x89,0x05,0xd7,0x16,0xe3,0x8d,0x9c,0x88,0x57,0x13,0x10,0xe9,0xb7,0xa0,
0x95,0x91,0x1f,0x85,0xa9,0xa1,0x05,0x63,0x4f,0x04,0x9d,0xa7,0x8f,0x32,0x85,0x6c,
0xb6,0x34,0x23,0x4d,0xa2,0x1a,0xa4,0x07,0xa2,0x03,0x39,0x6a,0xf4,0xbf,0x13,0xf1,
0xa6,0x7d,0xb4,0x38,0xe8,0x5d,0xc7,0x3e,0xfd,0xe5,0x28,0xe0,0xca,0xce,0xf7,0xdf,
0x2d,0xd8,0x5f,0x03,0xed,0x8c,0x96,0xe8,0x1f,0xab,0x4e,0x8e,0xab,0xb8,0x53,0x34,
0x8b,0x2d,0xf0,0x51,0x8a,0x6f,0x13,0x01,0xdf,0xb7,0xf6,0xca,0xcf,0xa4,0x6f,0x4e,
0xee,0xad,0xd1,0xb9,0xfc,0x9b,0x58,0x99,0x0f,0xaf,0xa6,0xc8,0x0a,0xf4,0xf4,0x85,
0xe1,0xed,0xad,0x84,0xc7,0x1f,0x3c,0xcb,0xb5,0xd2,0x5c,0xa0,0x04,0x4f,0x8a,0x46,
0x87,0xab,0x30,0x79,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9a,0x76,0xf1,0x62,0xd8,
0x7c,0x81,0x2d,0x03,0xf6,0xf0,0x6b,0x9a,0x1f,0xd1,0x69,0x04,0x60,0x4a,0x3a,0x07,
0x15,0x1d,0x18,0x6f,0xf6,0x9b,0xe2,0x5d,0x3a,0x0b,0xe3,0xc7,0x4a,0xc3,0xd0,0x22,
0x29,0x4f,0xef,0x47,0xc4,0x0b,0xb7,0x77,0xec,0xc8,0x30,0x5f,0x0e,0xf5,0x9a,0xa3,
0x24,0x69,0x66,0x8c,0x35,0x76,0xdd,0xd6,0x26,0xd1,0x7c,0x7d,0xaf,0xeb,0x73,0x66,
0x02,0x71,0xc4,0x54,0x06,0xd1,0x57,0x95,0x1f,0x18,0xa3,0x00,0x92,0x9c,0xdf,0xf4,
0x51,0xf2,0x7a,0x5a,0x9d,0xe5,0xbe,0xff,0xc7,0x02,0x65,0xff,0xea,0x4f,0xdb,0x41,
0x47,0xd5,0xa1,0x5b,0x11,0x93,0xf8,0xd6,0x28,0xb6,0x4d,0xa6,0x0c,0x30,0x35,0x02,
0x01,0x01,0x04,0x30,0x29,0x92,0x92,0xf0,0x19,0xa9,0xaf,0x5e,0x00,0xf0,0xb4,0xb2,
0x04,0x03,0xea,0x93,0x54,0x80,0xb7,0xa2,0x02,0x64,0x6f,0x3b,0xd3,0x00,0x85,0x09,
0xdc,0x75,0x2f,0x89,0x5f,0xe0,0x67,0x5c,0x81,0x55,0xd8,0x14,0x1e,0x72,0x47,0xf8,
0x62,0x18,0x14,0x0a,0x30,0x65,0x02,0x01,0x01,0x04,0x60,0x8f,0x49,0x88,0xfe,0x68,
0xff,0xa2,0x4a,0xc9,0x20,0x6b,0x48,0xb7,0x43,0xe2,0xed,0x6e,0x77,0xd1,0xd2,0xc0,
0xed,0xad,0x37,0x9b,0x21,0x51,0xd8,0x9c,0xf1,0xad,0xc0,0xf0,0xc5,0x72,0x00,0x77,
0x04,0x92,0xe4,0x9a,0x50,0x1f,0x00,0xd5,0x52,0x8d,0x50,0x6f,0x8b,0x1e,0x81,0x8b,
0xb5,0xb1,0x37,0xbc,0xb4,0xf0,0xf3,0x9e,0x90,0xf3,0x59,0x52,0xef,0xed,0x78,0xa9,
0x3c,0xa9,0x59,0xe4,0x43,0xc5,0x78,0x13,0xa5,0x50,0x02,0xef,0x1d,0x74,0xc5,0x90,
0xa5,0xae,0x3d,0x99,0x72,0x39,0x51,0x31,0x42,0x0e,0x8e
};

static const guint8 data_broken_fingerprint1[] = {
0x30,0x82,0x01,0xd7,0x02,0x01,0x01,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9a,0x76,
0xf1,0x62,0xd8,0x7c,0x81,0x2d,0x03,0xf6,0xf0,0x6b,0x9a,0x1f,0xd1,0x69,0x30,0x82,
0x01,0x1b,0x02,0x01,0x01,0x30,0x81,0x9a,0x33,0x15,0x02,0x01,0x01,0x04,0x10,0x9b,
/*                                         ^ damage (not a sequence tag) */
0xf5,0xc4,0xeb,0xc2,0xf0,0xa0,0x2b,0xde,0xf6,0x37,0x63,0xf6,0x0c,0x30,0x2c,0x04,
0x81,0x80,0x89,0x05,0xd7,0x16,0xe3,0x8d,0x9c,0x88,0x57,0x13,0x10,0xe9,0xb7,0xa0,
0x95,0x91,0x1f,0x85,0xa9,0xa1,0x05,0x63,0x4f,0x04,0x9d,0xa7,0x8f,0x32,0x85,0x6c,
0xb6,0x34,0x23,0x4d,0xa2,0x1a,0xa4,0x07,0xa2,0x03,0x39,0x6a,0xf4,0xbf,0x13,0xf1,
0xa6,0x7d,0xb4,0x38,0xe8,0x5d,0xc7,0x3e,0xfd,0xe5,0x28,0xe0,0xca,0xce,0xf7,0xdf,
0x2d,0xd8,0x5f,0x03,0xed,0x8c,0x96,0xe8,0x1f,0xab,0x4e,0x8e,0xab,0xb8,0x53,0x34,
0x8b,0x2d,0xf0,0x51,0x8a,0x6f,0x13,0x01,0xdf,0xb7,0xf6,0xca,0xcf,0xa4,0x6f,0x4e,
0xee,0xad,0xd1,0xb9,0xfc,0x9b,0x58,0x99,0x0f,0xaf,0xa6,0xc8,0x0a,0xf4,0xf4,0x85,
0xe1,0xed,0xad,0x84,0xc7,0x1f,0x3c,0xcb,0xb5,0xd2,0x5c,0xa0,0x04,0x4f,0x8a,0x46,
0x87,0xab,0x30,0x79,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9a,0x76,0xf1,0x62,0xd8,
0x7c,0x81,0x2d,0x03,0xf6,0xf0,0x6b,0x9a,0x1f,0xd1,0x69,0x04,0x60,0x4a,0x3a,0x07,
0x15,0x1d,0x18,0x6f,0xf6,0x9b,0xe2,0x5d,0x3a,0x0b,0xe3,0xc7,0x4a,0xc3,0xd0,0x22,
0x29,0x4f,0xef,0x47,0xc4,0x0b,0xb7,0x77,0xec,0xc8,0x30,0x5f,0x0e,0xf5,0x9a,0xa3,
0x24,0x69,0x66,0x8c,0x35,0x76,0xdd,0xd6,0x26,0xd1,0x7c,0x7d,0xaf,0xeb,0x73,0x66,
0x02,0x71,0xc4,0x54,0x06,0xd1,0x57,0x95,0x1f,0x18,0xa3,0x00,0x92,0x9c,0xdf,0xf4,
0x51,0xf2,0x7a,0x5a,0x9d,0xe5,0xbe,0xff,0xc7,0x02,0x65,0xff,0xea,0x4f,0xdb,0x41,
0x47,0xd5,0xa1,0x5b,0x11,0x93,0xf8,0xd6,0x28,0xb6,0x4d,0xa6,0x0c,0x30,0x35,0x02,
0x01,0x01,0x04,0x30,0x29,0x92,0x92,0xf0,0x19,0xa9,0xaf,0x5e,0x00,0xf0,0xb4,0xb2,
0x04,0x03,0xea,0x93,0x54,0x80,0xb7,0xa2,0x02,0x64,0x6f,0x3b,0xd3,0x00,0x85,0x09,
0xdc,0x75,0x2f,0x89,0x5f,0xe0,0x67,0x5c,0x81,0x55,0xd8,0x14,0x1e,0x72,0x47,0xf8,
0x62,0x18,0x14,0x0a,0x30,0x65,0x02,0x01,0x01,0x04,0x60,0x8f,0x49,0x88,0xfe,0x68,
0xff,0xa2,0x4a,0xc9,0x20,0x6b,0x48,0xb7,0x43,0xe2,0xed,0x6e,0x77,0xd1,0xd2,0xc0,
0xed,0xad,0x37,0x9b,0x21,0x51,0xd8,0x9c,0xf1,0xad,0xc0,0xf0,0xc5,0x72,0x00,0x77,
0x04,0x92,0xe4,0x9a,0x50,0x1f,0x00,0xd5,0x52,0x8d,0x50,0x6f,0x8b,0x1e,0x81,0x8b,
0xb5,0xb1,0x37,0xbc,0xb4,0xf0,0xf3,0x9e,0x90,0xf3,0x59,0x52,0xef,0xed,0x78,0xa9,
0x3c,0xa9,0x59,0xe4,0x43,0xc5,0x78,0x13,0xa5,0x50,0x02,0xef,0x1d,0x74,0xc5,0x90,
0xa5,0xae,0x3d,0x99,0x72,0x39,0x51,0x31,0x42,0x0e,0x8e
};

static const guint8 data_broken_fingerprint2[] = {
0x30,0x82,0x01,0xd7,0x02,0x01,0x01,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9a,0x76,
0xf1,0x62,0xd8,0x7c,0x81,0x2d,0x03,0xf6,0xf0,0x6b,0x9a,0x1f,0xd1,0x69,0x30,0x82,
0x01,0x1b,0x02,0x01,0x01,0x30,0x81,0x9a,0x30,0x15,0x05,0x01,0x01,0x04,0x10,0x9b,
/*     damage (fingerprint format is not an integer) ^ */
0xf5,0xc4,0xeb,0xc2,0xf0,0xa0,0x2b,0xde,0xf6,0x37,0x63,0xf6,0x0c,0x30,0x2c,0x04,
0x81,0x80,0x89,0x05,0xd7,0x16,0xe3,0x8d,0x9c,0x88,0x57,0x13,0x10,0xe9,0xb7,0xa0,
0x95,0x91,0x1f,0x85,0xa9,0xa1,0x05,0x63,0x4f,0x04,0x9d,0xa7,0x8f,0x32,0x85,0x6c,
0xb6,0x34,0x23,0x4d,0xa2,0x1a,0xa4,0x07,0xa2,0x03,0x39,0x6a,0xf4,0xbf,0x13,0xf1,
0xa6,0x7d,0xb4,0x38,0xe8,0x5d,0xc7,0x3e,0xfd,0xe5,0x28,0xe0,0xca,0xce,0xf7,0xdf,
0x2d,0xd8,0x5f,0x03,0xed,0x8c,0x96,0xe8,0x1f,0xab,0x4e,0x8e,0xab,0xb8,0x53,0x34,
0x8b,0x2d,0xf0,0x51,0x8a,0x6f,0x13,0x01,0xdf,0xb7,0xf6,0xca,0xcf,0xa4,0x6f,0x4e,
0xee,0xad,0xd1,0xb9,0xfc,0x9b,0x58,0x99,0x0f,0xaf,0xa6,0xc8,0x0a,0xf4,0xf4,0x85,
0xe1,0xed,0xad,0x84,0xc7,0x1f,0x3c,0xcb,0xb5,0xd2,0x5c,0xa0,0x04,0x4f,0x8a,0x46,
0x87,0xab,0x30,0x79,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9a,0x76,0xf1,0x62,0xd8,
0x7c,0x81,0x2d,0x03,0xf6,0xf0,0x6b,0x9a,0x1f,0xd1,0x69,0x04,0x60,0x4a,0x3a,0x07,
0x15,0x1d,0x18,0x6f,0xf6,0x9b,0xe2,0x5d,0x3a,0x0b,0xe3,0xc7,0x4a,0xc3,0xd0,0x22,
0x29,0x4f,0xef,0x47,0xc4,0x0b,0xb7,0x77,0xec,0xc8,0x30,0x5f,0x0e,0xf5,0x9a,0xa3,
0x24,0x69,0x66,0x8c,0x35,0x76,0xdd,0xd6,0x26,0xd1,0x7c,0x7d,0xaf,0xeb,0x73,0x66,
0x02,0x71,0xc4,0x54,0x06,0xd1,0x57,0x95,0x1f,0x18,0xa3,0x00,0x92,0x9c,0xdf,0xf4,
0x51,0xf2,0x7a,0x5a,0x9d,0xe5,0xbe,0xff,0xc7,0x02,0x65,0xff,0xea,0x4f,0xdb,0x41,
0x47,0xd5,0xa1,0x5b,0x11,0x93,0xf8,0xd6,0x28,0xb6,0x4d,0xa6,0x0c,0x30,0x35,0x02,
0x01,0x01,0x04,0x30,0x29,0x92,0x92,0xf0,0x19,0xa9,0xaf,0x5e,0x00,0xf0,0xb4,0xb2,
0x04,0x03,0xea,0x93,0x54,0x80,0xb7,0xa2,0x02,0x64,0x6f,0x3b,0xd3,0x00,0x85,0x09,
0xdc,0x75,0x2f,0x89,0x5f,0xe0,0x67,0x5c,0x81,0x55,0xd8,0x14,0x1e,0x72,0x47,0xf8,
0x62,0x18,0x14,0x0a,0x30,0x65,0x02,0x01,0x01,0x04,0x60,0x8f,0x49,0x88,0xfe,0x68,
0xff,0xa2,0x4a,0xc9,0x20,0x6b,0x48,0xb7,0x43,0xe2,0xed,0x6e,0x77,0xd1,0xd2,0xc0,
0xed,0xad,0x37,0x9b,0x21,0x51,0xd8,0x9c,0xf1,0xad,0xc0,0xf0,0xc5,0x72,0x00,0x77,
0x04,0x92,0xe4,0x9a,0x50,0x1f,0x00,0xd5,0x52,0x8d,0x50,0x6f,0x8b,0x1e,0x81,0x8b,
0xb5,0xb1,0x37,0xbc,0xb4,0xf0,0xf3,0x9e,0x90,0xf3,0x59,0x52,0xef,0xed,0x78,0xa9,
0x3c,0xa9,0x59,0xe4,0x43,0xc5,0x78,0x13,0xa5,0x50,0x02,0xef,0x1d,0x74,0xc5,0x90,
0xa5,0xae,0x3d,0x99,0x72,0x39,0x51,0x31,0x42,0x0e,0x8e
};

static const guint8 data_broken_fingerprint3[] = {
0x30,0x82,0x01,0xd7,0x02,0x01,0x01,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9a,0x76,
0xf1,0x62,0xd8,0x7c,0x81,0x2d,0x03,0xf6,0xf0,0x6b,0x9a,0x1f,0xd1,0x69,0x30,0x82,
0x01,0x1b,0x02,0x01,0x01,0x30,0x81,0x9a,0x30,0x15,0x02,0x01,0x01,0x05,0x10,0x9b,
/*                 damage (fingerprint data is not an octet string) ^ */
0xf5,0xc4,0xeb,0xc2,0xf0,0xa0,0x2b,0xde,0xf6,0x37,0x63,0xf6,0x0c,0x30,0x2c,0x04,
0x81,0x80,0x89,0x05,0xd7,0x16,0xe3,0x8d,0x9c,0x88,0x57,0x13,0x10,0xe9,0xb7,0xa0,
0x95,0x91,0x1f,0x85,0xa9,0xa1,0x05,0x63,0x4f,0x04,0x9d,0xa7,0x8f,0x32,0x85,0x6c,
0xb6,0x34,0x23,0x4d,0xa2,0x1a,0xa4,0x07,0xa2,0x03,0x39,0x6a,0xf4,0xbf,0x13,0xf1,
0xa6,0x7d,0xb4,0x38,0xe8,0x5d,0xc7,0x3e,0xfd,0xe5,0x28,0xe0,0xca,0xce,0xf7,0xdf,
0x2d,0xd8,0x5f,0x03,0xed,0x8c,0x96,0xe8,0x1f,0xab,0x4e,0x8e,0xab,0xb8,0x53,0x34,
0x8b,0x2d,0xf0,0x51,0x8a,0x6f,0x13,0x01,0xdf,0xb7,0xf6,0xca,0xcf,0xa4,0x6f,0x4e,
0xee,0xad,0xd1,0xb9,0xfc,0x9b,0x58,0x99,0x0f,0xaf,0xa6,0xc8,0x0a,0xf4,0xf4,0x85,
0xe1,0xed,0xad,0x84,0xc7,0x1f,0x3c,0xcb,0xb5,0xd2,0x5c,0xa0,0x04,0x4f,0x8a,0x46,
0x87,0xab,0x30,0x79,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9a,0x76,0xf1,0x62,0xd8,
0x7c,0x81,0x2d,0x03,0xf6,0xf0,0x6b,0x9a,0x1f,0xd1,0x69,0x04,0x60,0x4a,0x3a,0x07,
0x15,0x1d,0x18,0x6f,0xf6,0x9b,0xe2,0x5d,0x3a,0x0b,0xe3,0xc7,0x4a,0xc3,0xd0,0x22,
0x29,0x4f,0xef,0x47,0xc4,0x0b,0xb7,0x77,0xec,0xc8,0x30,0x5f,0x0e,0xf5,0x9a,0xa3,
0x24,0x69,0x66,0x8c,0x35,0x76,0xdd,0xd6,0x26,0xd1,0x7c,0x7d,0xaf,0xeb,0x73,0x66,
0x02,0x71,0xc4,0x54,0x06,0xd1,0x57,0x95,0x1f,0x18,0xa3,0x00,0x92,0x9c,0xdf,0xf4,
0x51,0xf2,0x7a,0x5a,0x9d,0xe5,0xbe,0xff,0xc7,0x02,0x65,0xff,0xea,0x4f,0xdb,0x41,
0x47,0xd5,0xa1,0x5b,0x11,0x93,0xf8,0xd6,0x28,0xb6,0x4d,0xa6,0x0c,0x30,0x35,0x02,
0x01,0x01,0x04,0x30,0x29,0x92,0x92,0xf0,0x19,0xa9,0xaf,0x5e,0x00,0xf0,0xb4,0xb2,
0x04,0x03,0xea,0x93,0x54,0x80,0xb7,0xa2,0x02,0x64,0x6f,0x3b,0xd3,0x00,0x85,0x09,
0xdc,0x75,0x2f,0x89,0x5f,0xe0,0x67,0x5c,0x81,0x55,0xd8,0x14,0x1e,0x72,0x47,0xf8,
0x62,0x18,0x14,0x0a,0x30,0x65,0x02,0x01,0x01,0x04,0x60,0x8f,0x49,0x88,0xfe,0x68,
0xff,0xa2,0x4a,0xc9,0x20,0x6b,0x48,0xb7,0x43,0xe2,0xed,0x6e,0x77,0xd1,0xd2,0xc0,
0xed,0xad,0x37,0x9b,0x21,0x51,0xd8,0x9c,0xf1,0xad,0xc0,0xf0,0xc5,0x72,0x00,0x77,
0x04,0x92,0xe4,0x9a,0x50,0x1f,0x00,0xd5,0x52,0x8d,0x50,0x6f,0x8b,0x1e,0x81,0x8b,
0xb5,0xb1,0x37,0xbc,0xb4,0xf0,0xf3,0x9e,0x90,0xf3,0x59,0x52,0xef,0xed,0x78,0xa9,
0x3c,0xa9,0x59,0xe4,0x43,0xc5,0x78,0x13,0xa5,0x50,0x02,0xef,0x1d,0x74,0xc5,0x90,
0xa5,0xae,0x3d,0x99,0x72,0x39,0x51,0x31,0x42,0x0e,0x8e
};

static const guint8 data_broken_fingerprint4[] = {
0x30,0x82,0x01,0xd7,0x02,0x01,0x01,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9a,0x76,
0xf1,0x62,0xd8,0x7c,0x81,0x2d,0x03,0xf6,0xf0,0x6b,0x9a,0x1f,0xd1,0x69,0x30,0x82,
0x01,0x1b,0x02,0x01,0x01,0x30,0x81,0x9a,0x30,0x15,0x02,0x01,0x01,0x04,0x0f,0x9b,
/*                                              damage (invalid length) ^^ */
0xf5,0xc4,0xeb,0xc2,0xf0,0xa0,0x2b,0xde,0xf6,0x37,0x63,0xf6,0x0c,0x30,0x2c,0x04,
0x81,0x80,0x89,0x05,0xd7,0x16,0xe3,0x8d,0x9c,0x88,0x57,0x13,0x10,0xe9,0xb7,0xa0,
0x95,0x91,0x1f,0x85,0xa9,0xa1,0x05,0x63,0x4f,0x04,0x9d,0xa7,0x8f,0x32,0x85,0x6c,
0xb6,0x34,0x23,0x4d,0xa2,0x1a,0xa4,0x07,0xa2,0x03,0x39,0x6a,0xf4,0xbf,0x13,0xf1,
0xa6,0x7d,0xb4,0x38,0xe8,0x5d,0xc7,0x3e,0xfd,0xe5,0x28,0xe0,0xca,0xce,0xf7,0xdf,
0x2d,0xd8,0x5f,0x03,0xed,0x8c,0x96,0xe8,0x1f,0xab,0x4e,0x8e,0xab,0xb8,0x53,0x34,
0x8b,0x2d,0xf0,0x51,0x8a,0x6f,0x13,0x01,0xdf,0xb7,0xf6,0xca,0xcf,0xa4,0x6f,0x4e,
0xee,0xad,0xd1,0xb9,0xfc,0x9b,0x58,0x99,0x0f,0xaf,0xa6,0xc8,0x0a,0xf4,0xf4,0x85,
0xe1,0xed,0xad,0x84,0xc7,0x1f,0x3c,0xcb,0xb5,0xd2,0x5c,0xa0,0x04,0x4f,0x8a,0x46,
0x87,0xab,0x30,0x79,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9a,0x76,0xf1,0x62,0xd8,
0x7c,0x81,0x2d,0x03,0xf6,0xf0,0x6b,0x9a,0x1f,0xd1,0x69,0x04,0x60,0x4a,0x3a,0x07,
0x15,0x1d,0x18,0x6f,0xf6,0x9b,0xe2,0x5d,0x3a,0x0b,0xe3,0xc7,0x4a,0xc3,0xd0,0x22,
0x29,0x4f,0xef,0x47,0xc4,0x0b,0xb7,0x77,0xec,0xc8,0x30,0x5f,0x0e,0xf5,0x9a,0xa3,
0x24,0x69,0x66,0x8c,0x35,0x76,0xdd,0xd6,0x26,0xd1,0x7c,0x7d,0xaf,0xeb,0x73,0x66,
0x02,0x71,0xc4,0x54,0x06,0xd1,0x57,0x95,0x1f,0x18,0xa3,0x00,0x92,0x9c,0xdf,0xf4,
0x51,0xf2,0x7a,0x5a,0x9d,0xe5,0xbe,0xff,0xc7,0x02,0x65,0xff,0xea,0x4f,0xdb,0x41,
0x47,0xd5,0xa1,0x5b,0x11,0x93,0xf8,0xd6,0x28,0xb6,0x4d,0xa6,0x0c,0x30,0x35,0x02,
0x01,0x01,0x04,0x30,0x29,0x92,0x92,0xf0,0x19,0xa9,0xaf,0x5e,0x00,0xf0,0xb4,0xb2,
0x04,0x03,0xea,0x93,0x54,0x80,0xb7,0xa2,0x02,0x64,0x6f,0x3b,0xd3,0x00,0x85,0x09,
0xdc,0x75,0x2f,0x89,0x5f,0xe0,0x67,0x5c,0x81,0x55,0xd8,0x14,0x1e,0x72,0x47,0xf8,
0x62,0x18,0x14,0x0a,0x30,0x65,0x02,0x01,0x01,0x04,0x60,0x8f,0x49,0x88,0xfe,0x68,
0xff,0xa2,0x4a,0xc9,0x20,0x6b,0x48,0xb7,0x43,0xe2,0xed,0x6e,0x77,0xd1,0xd2,0xc0,
0xed,0xad,0x37,0x9b,0x21,0x51,0xd8,0x9c,0xf1,0xad,0xc0,0xf0,0xc5,0x72,0x00,0x77,
0x04,0x92,0xe4,0x9a,0x50,0x1f,0x00,0xd5,0x52,0x8d,0x50,0x6f,0x8b,0x1e,0x81,0x8b,
0xb5,0xb1,0x37,0xbc,0xb4,0xf0,0xf3,0x9e,0x90,0xf3,0x59,0x52,0xef,0xed,0x78,0xa9,
0x3c,0xa9,0x59,0xe4,0x43,0xc5,0x78,0x13,0xa5,0x50,0x02,0xef,0x1d,0x74,0xc5,0x90,
0xa5,0xae,0x3d,0x99,0x72,0x39,0x51,0x31,0x42,0x0e,0x8e
};

static const guint8 data_invalid_fingerprint_format[] = {
0x30,0x82,0x01,0xd7,0x02,0x01,0x01,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9a,0x76,
0xf1,0x62,0xd8,0x7c,0x81,0x2d,0x03,0xf6,0xf0,0x6b,0x9a,0x1f,0xd1,0x69,0x30,0x82,
0x01,0x1b,0x02,0x01,0x01,0x30,0x81,0x9a,0x30,0x15,0x02,0x01,0xff,0x04,0x10,0x9b,
/*                                       damage (format = -1) ^^ */
0xf5,0xc4,0xeb,0xc2,0xf0,0xa0,0x2b,0xde,0xf6,0x37,0x63,0xf6,0x0c,0x30,0x2c,0x04,
0x81,0x80,0x89,0x05,0xd7,0x16,0xe3,0x8d,0x9c,0x88,0x57,0x13,0x10,0xe9,0xb7,0xa0,
0x95,0x91,0x1f,0x85,0xa9,0xa1,0x05,0x63,0x4f,0x04,0x9d,0xa7,0x8f,0x32,0x85,0x6c,
0xb6,0x34,0x23,0x4d,0xa2,0x1a,0xa4,0x07,0xa2,0x03,0x39,0x6a,0xf4,0xbf,0x13,0xf1,
0xa6,0x7d,0xb4,0x38,0xe8,0x5d,0xc7,0x3e,0xfd,0xe5,0x28,0xe0,0xca,0xce,0xf7,0xdf,
0x2d,0xd8,0x5f,0x03,0xed,0x8c,0x96,0xe8,0x1f,0xab,0x4e,0x8e,0xab,0xb8,0x53,0x34,
0x8b,0x2d,0xf0,0x51,0x8a,0x6f,0x13,0x01,0xdf,0xb7,0xf6,0xca,0xcf,0xa4,0x6f,0x4e,
0xee,0xad,0xd1,0xb9,0xfc,0x9b,0x58,0x99,0x0f,0xaf,0xa6,0xc8,0x0a,0xf4,0xf4,0x85,
0xe1,0xed,0xad,0x84,0xc7,0x1f,0x3c,0xcb,0xb5,0xd2,0x5c,0xa0,0x04,0x4f,0x8a,0x46,
0x87,0xab,0x30,0x79,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9a,0x76,0xf1,0x62,0xd8,
0x7c,0x81,0x2d,0x03,0xf6,0xf0,0x6b,0x9a,0x1f,0xd1,0x69,0x04,0x60,0x4a,0x3a,0x07,
0x15,0x1d,0x18,0x6f,0xf6,0x9b,0xe2,0x5d,0x3a,0x0b,0xe3,0xc7,0x4a,0xc3,0xd0,0x22,
0x29,0x4f,0xef,0x47,0xc4,0x0b,0xb7,0x77,0xec,0xc8,0x30,0x5f,0x0e,0xf5,0x9a,0xa3,
0x24,0x69,0x66,0x8c,0x35,0x76,0xdd,0xd6,0x26,0xd1,0x7c,0x7d,0xaf,0xeb,0x73,0x66,
0x02,0x71,0xc4,0x54,0x06,0xd1,0x57,0x95,0x1f,0x18,0xa3,0x00,0x92,0x9c,0xdf,0xf4,
0x51,0xf2,0x7a,0x5a,0x9d,0xe5,0xbe,0xff,0xc7,0x02,0x65,0xff,0xea,0x4f,0xdb,0x41,
0x47,0xd5,0xa1,0x5b,0x11,0x93,0xf8,0xd6,0x28,0xb6,0x4d,0xa6,0x0c,0x30,0x35,0x02,
0x01,0x01,0x04,0x30,0x29,0x92,0x92,0xf0,0x19,0xa9,0xaf,0x5e,0x00,0xf0,0xb4,0xb2,
0x04,0x03,0xea,0x93,0x54,0x80,0xb7,0xa2,0x02,0x64,0x6f,0x3b,0xd3,0x00,0x85,0x09,
0xdc,0x75,0x2f,0x89,0x5f,0xe0,0x67,0x5c,0x81,0x55,0xd8,0x14,0x1e,0x72,0x47,0xf8,
0x62,0x18,0x14,0x0a,0x30,0x65,0x02,0x01,0x01,0x04,0x60,0x8f,0x49,0x88,0xfe,0x68,
0xff,0xa2,0x4a,0xc9,0x20,0x6b,0x48,0xb7,0x43,0xe2,0xed,0x6e,0x77,0xd1,0xd2,0xc0,
0xed,0xad,0x37,0x9b,0x21,0x51,0xd8,0x9c,0xf1,0xad,0xc0,0xf0,0xc5,0x72,0x00,0x77,
0x04,0x92,0xe4,0x9a,0x50,0x1f,0x00,0xd5,0x52,0x8d,0x50,0x6f,0x8b,0x1e,0x81,0x8b,
0xb5,0xb1,0x37,0xbc,0xb4,0xf0,0xf3,0x9e,0x90,0xf3,0x59,0x52,0xef,0xed,0x78,0xa9,
0x3c,0xa9,0x59,0xe4,0x43,0xc5,0x78,0x13,0xa5,0x50,0x02,0xef,0x1d,0x74,0xc5,0x90,
0xa5,0xae,0x3d,0x99,0x72,0x39,0x51,0x31,0x42,0x0e,0x8e
};

static const guint8 data_broken_encrypted_key[] = {
0x30,0x82,0x01,0xd7,0x02,0x01,0x01,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9a,0x76,
0xf1,0x62,0xd8,0x7c,0x81,0x2d,0x03,0xf6,0xf0,0x6b,0x9a,0x1f,0xd1,0x69,0x30,0x82,
0x01,0x1b,0x02,0x01,0x01,0x30,0x81,0x9a,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9b,
0xf5,0xc4,0xeb,0xc2,0xf0,0xa0,0x2b,0xde,0xf6,0x37,0x63,0xf6,0x0c,0x30,0x2c,0x05,
/*                                           damage (not an octet string)  ^*/
0x81,0x80,0x89,0x05,0xd7,0x16,0xe3,0x8d,0x9c,0x88,0x57,0x13,0x10,0xe9,0xb7,0xa0,
0x95,0x91,0x1f,0x85,0xa9,0xa1,0x05,0x63,0x4f,0x04,0x9d,0xa7,0x8f,0x32,0x85,0x6c,
0xb6,0x34,0x23,0x4d,0xa2,0x1a,0xa4,0x07,0xa2,0x03,0x39,0x6a,0xf4,0xbf,0x13,0xf1,
0xa6,0x7d,0xb4,0x38,0xe8,0x5d,0xc7,0x3e,0xfd,0xe5,0x28,0xe0,0xca,0xce,0xf7,0xdf,
0x2d,0xd8,0x5f,0x03,0xed,0x8c,0x96,0xe8,0x1f,0xab,0x4e,0x8e,0xab,0xb8,0x53,0x34,
0x8b,0x2d,0xf0,0x51,0x8a,0x6f,0x13,0x01,0xdf,0xb7,0xf6,0xca,0xcf,0xa4,0x6f,0x4e,
0xee,0xad,0xd1,0xb9,0xfc,0x9b,0x58,0x99,0x0f,0xaf,0xa6,0xc8,0x0a,0xf4,0xf4,0x85,
0xe1,0xed,0xad,0x84,0xc7,0x1f,0x3c,0xcb,0xb5,0xd2,0x5c,0xa0,0x04,0x4f,0x8a,0x46,
0x87,0xab,0x30,0x79,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9a,0x76,0xf1,0x62,0xd8,
0x7c,0x81,0x2d,0x03,0xf6,0xf0,0x6b,0x9a,0x1f,0xd1,0x69,0x04,0x60,0x4a,0x3a,0x07,
0x15,0x1d,0x18,0x6f,0xf6,0x9b,0xe2,0x5d,0x3a,0x0b,0xe3,0xc7,0x4a,0xc3,0xd0,0x22,
0x29,0x4f,0xef,0x47,0xc4,0x0b,0xb7,0x77,0xec,0xc8,0x30,0x5f,0x0e,0xf5,0x9a,0xa3,
0x24,0x69,0x66,0x8c,0x35,0x76,0xdd,0xd6,0x26,0xd1,0x7c,0x7d,0xaf,0xeb,0x73,0x66,
0x02,0x71,0xc4,0x54,0x06,0xd1,0x57,0x95,0x1f,0x18,0xa3,0x00,0x92,0x9c,0xdf,0xf4,
0x51,0xf2,0x7a,0x5a,0x9d,0xe5,0xbe,0xff,0xc7,0x02,0x65,0xff,0xea,0x4f,0xdb,0x41,
0x47,0xd5,0xa1,0x5b,0x11,0x93,0xf8,0xd6,0x28,0xb6,0x4d,0xa6,0x0c,0x30,0x35,0x02,
0x01,0x01,0x04,0x30,0x29,0x92,0x92,0xf0,0x19,0xa9,0xaf,0x5e,0x00,0xf0,0xb4,0xb2,
0x04,0x03,0xea,0x93,0x54,0x80,0xb7,0xa2,0x02,0x64,0x6f,0x3b,0xd3,0x00,0x85,0x09,
0xdc,0x75,0x2f,0x89,0x5f,0xe0,0x67,0x5c,0x81,0x55,0xd8,0x14,0x1e,0x72,0x47,0xf8,
0x62,0x18,0x14,0x0a,0x30,0x65,0x02,0x01,0x01,0x04,0x60,0x8f,0x49,0x88,0xfe,0x68,
0xff,0xa2,0x4a,0xc9,0x20,0x6b,0x48,0xb7,0x43,0xe2,0xed,0x6e,0x77,0xd1,0xd2,0xc0,
0xed,0xad,0x37,0x9b,0x21,0x51,0xd8,0x9c,0xf1,0xad,0xc0,0xf0,0xc5,0x72,0x00,0x77,
0x04,0x92,0xe4,0x9a,0x50,0x1f,0x00,0xd5,0x52,0x8d,0x50,0x6f,0x8b,0x1e,0x81,0x8b,
0xb5,0xb1,0x37,0xbc,0xb4,0xf0,0xf3,0x9e,0x90,0xf3,0x59,0x52,0xef,0xed,0x78,0xa9,
0x3c,0xa9,0x59,0xe4,0x43,0xc5,0x78,0x13,0xa5,0x50,0x02,0xef,0x1d,0x74,0xc5,0x90,
0xa5,0xae,0x3d,0x99,0x72,0x39,0x51,0x31,0x42,0x0e,0x8e
};

static const guint8 data_broken_encrypted_data_block[] = {
0x30,0x82,0x01,0xd7,0x02,0x01,0x01,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9a,0x76,
0xf1,0x62,0xd8,0x7c,0x81,0x2d,0x03,0xf6,0xf0,0x6b,0x9a,0x1f,0xd1,0x69,0x30,0x82,
0x01,0x1b,0x02,0x01,0x01,0x30,0x81,0x9a,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9b,
0xf5,0xc4,0xeb,0xc2,0xf0,0xa0,0x2b,0xde,0xf6,0x37,0x63,0xf6,0x0c,0x30,0x2c,0x04,
0x81,0x80,0x89,0x05,0xd7,0x16,0xe3,0x8d,0x9c,0x88,0x57,0x13,0x10,0xe9,0xb7,0xa0,
0x95,0x91,0x1f,0x85,0xa9,0xa1,0x05,0x63,0x4f,0x04,0x9d,0xa7,0x8f,0x32,0x85,0x6c,
0xb6,0x34,0x23,0x4d,0xa2,0x1a,0xa4,0x07,0xa2,0x03,0x39,0x6a,0xf4,0xbf,0x13,0xf1,
0xa6,0x7d,0xb4,0x38,0xe8,0x5d,0xc7,0x3e,0xfd,0xe5,0x28,0xe0,0xca,0xce,0xf7,0xdf,
0x2d,0xd8,0x5f,0x03,0xed,0x8c,0x96,0xe8,0x1f,0xab,0x4e,0x8e,0xab,0xb8,0x53,0x34,
0x8b,0x2d,0xf0,0x51,0x8a,0x6f,0x13,0x01,0xdf,0xb7,0xf6,0xca,0xcf,0xa4,0x6f,0x4e,
0xee,0xad,0xd1,0xb9,0xfc,0x9b,0x58,0x99,0x0f,0xaf,0xa6,0xc8,0x0a,0xf4,0xf4,0x85,
0xe1,0xed,0xad,0x84,0xc7,0x1f,0x3c,0xcb,0xb5,0xd2,0x5c,0xa0,0x04,0x4f,0x8a,0x46,
0x87,0xab,0x30,0x79,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9a,0x76,0xf1,0x62,0xd8,
0x7c,0x81,0x2d,0x03,0xf6,0xf0,0x6b,0x9a,0x1f,0xd1,0x69,0x04,0x60,0x4a,0x3a,0x07,
0x15,0x1d,0x18,0x6f,0xf6,0x9b,0xe2,0x5d,0x3a,0x0b,0xe3,0xc7,0x4a,0xc3,0xd0,0x22,
0x29,0x4f,0xef,0x47,0xc4,0x0b,0xb7,0x77,0xec,0xc8,0x30,0x5f,0x0e,0xf5,0x9a,0xa3,
0x24,0x69,0x66,0x8c,0x35,0x76,0xdd,0xd6,0x26,0xd1,0x7c,0x7d,0xaf,0xeb,0x73,0x66,
0x02,0x71,0xc4,0x54,0x06,0xd1,0x57,0x95,0x1f,0x18,0xa3,0x00,0x92,0x9c,0xdf,0xf4,
0x51,0xf2,0x7a,0x5a,0x9d,0xe5,0xbe,0xff,0xc7,0x02,0x65,0xff,0xea,0x4f,0xdb,0x41,
0x47,0xd5,0xa1,0x5b,0x11,0x93,0xf8,0xd6,0x28,0xb6,0x4d,0xa6,0x0c,0x33,0x35,0x02,
/*                                      damage (not a sequence tag) ^ */
0x01,0x01,0x04,0x30,0x29,0x92,0x92,0xf0,0x19,0xa9,0xaf,0x5e,0x00,0xf0,0xb4,0xb2,
0x04,0x03,0xea,0x93,0x54,0x80,0xb7,0xa2,0x02,0x64,0x6f,0x3b,0xd3,0x00,0x85,0x09,
0xdc,0x75,0x2f,0x89,0x5f,0xe0,0x67,0x5c,0x81,0x55,0xd8,0x14,0x1e,0x72,0x47,0xf8,
0x62,0x18,0x14,0x0a,0x30,0x65,0x02,0x01,0x01,0x04,0x60,0x8f,0x49,0x88,0xfe,0x68,
0xff,0xa2,0x4a,0xc9,0x20,0x6b,0x48,0xb7,0x43,0xe2,0xed,0x6e,0x77,0xd1,0xd2,0xc0,
0xed,0xad,0x37,0x9b,0x21,0x51,0xd8,0x9c,0xf1,0xad,0xc0,0xf0,0xc5,0x72,0x00,0x77,
0x04,0x92,0xe4,0x9a,0x50,0x1f,0x00,0xd5,0x52,0x8d,0x50,0x6f,0x8b,0x1e,0x81,0x8b,
0xb5,0xb1,0x37,0xbc,0xb4,0xf0,0xf3,0x9e,0x90,0xf3,0x59,0x52,0xef,0xed,0x78,0xa9,
0x3c,0xa9,0x59,0xe4,0x43,0xc5,0x78,0x13,0xa5,0x50,0x02,0xef,0x1d,0x74,0xc5,0x90,
0xa5,0xae,0x3d,0x99,0x72,0x39,0x51,0x31,0x42,0x0e,0x8e
};

static const guint8 data_invalid_encrypted_data_tag[] = {
0x30,0x82,0x01,0xd7,0x02,0x01,0x01,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9a,0x76,
0xf1,0x62,0xd8,0x7c,0x81,0x2d,0x03,0xf6,0xf0,0x6b,0x9a,0x1f,0xd1,0x69,0x30,0x82,
0x01,0x1b,0x02,0x01,0x01,0x30,0x81,0x9a,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9b,
0xf5,0xc4,0xeb,0xc2,0xf0,0xa0,0x2b,0xde,0xf6,0x37,0x63,0xf6,0x0c,0x30,0x2c,0x04,
0x81,0x80,0x89,0x05,0xd7,0x16,0xe3,0x8d,0x9c,0x88,0x57,0x13,0x10,0xe9,0xb7,0xa0,
0x95,0x91,0x1f,0x85,0xa9,0xa1,0x05,0x63,0x4f,0x04,0x9d,0xa7,0x8f,0x32,0x85,0x6c,
0xb6,0x34,0x23,0x4d,0xa2,0x1a,0xa4,0x07,0xa2,0x03,0x39,0x6a,0xf4,0xbf,0x13,0xf1,
0xa6,0x7d,0xb4,0x38,0xe8,0x5d,0xc7,0x3e,0xfd,0xe5,0x28,0xe0,0xca,0xce,0xf7,0xdf,
0x2d,0xd8,0x5f,0x03,0xed,0x8c,0x96,0xe8,0x1f,0xab,0x4e,0x8e,0xab,0xb8,0x53,0x34,
0x8b,0x2d,0xf0,0x51,0x8a,0x6f,0x13,0x01,0xdf,0xb7,0xf6,0xca,0xcf,0xa4,0x6f,0x4e,
0xee,0xad,0xd1,0xb9,0xfc,0x9b,0x58,0x99,0x0f,0xaf,0xa6,0xc8,0x0a,0xf4,0xf4,0x85,
0xe1,0xed,0xad,0x84,0xc7,0x1f,0x3c,0xcb,0xb5,0xd2,0x5c,0xa0,0x04,0x4f,0x8a,0x46,
0x87,0xab,0x30,0x79,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9a,0x76,0xf1,0x62,0xd8,
0x7c,0x81,0x2d,0x03,0xf6,0xf0,0x6b,0x9a,0x1f,0xd1,0x69,0x04,0x60,0x4a,0x3a,0x07,
0x15,0x1d,0x18,0x6f,0xf6,0x9b,0xe2,0x5d,0x3a,0x0b,0xe3,0xc7,0x4a,0xc3,0xd0,0x22,
0x29,0x4f,0xef,0x47,0xc4,0x0b,0xb7,0x77,0xec,0xc8,0x30,0x5f,0x0e,0xf5,0x9a,0xa3,
0x24,0x69,0x66,0x8c,0x35,0x76,0xdd,0xd6,0x26,0xd1,0x7c,0x7d,0xaf,0xeb,0x73,0x66,
0x02,0x71,0xc4,0x54,0x06,0xd1,0x57,0x95,0x1f,0x18,0xa3,0x00,0x92,0x9c,0xdf,0xf4,
0x51,0xf2,0x7a,0x5a,0x9d,0xe5,0xbe,0xff,0xc7,0x02,0x65,0xff,0xea,0x4f,0xdb,0x41,
0x47,0xd5,0xa1,0x5b,0x11,0x93,0xf8,0xd6,0x28,0xb6,0x4d,0xa6,0x0c,0x30,0x35,0x02,
0x01,0xff,0x04,0x30,0x29,0x92,0x92,0xf0,0x19,0xa9,0xaf,0x5e,0x00,0xf0,0xb4,0xb2,
/*     ^^ damage (data tag = -1) */
0x04,0x03,0xea,0x93,0x54,0x80,0xb7,0xa2,0x02,0x64,0x6f,0x3b,0xd3,0x00,0x85,0x09,
0xdc,0x75,0x2f,0x89,0x5f,0xe0,0x67,0x5c,0x81,0x55,0xd8,0x14,0x1e,0x72,0x47,0xf8,
0x62,0x18,0x14,0x0a,0x30,0x65,0x02,0x01,0x01,0x04,0x60,0x8f,0x49,0x88,0xfe,0x68,
0xff,0xa2,0x4a,0xc9,0x20,0x6b,0x48,0xb7,0x43,0xe2,0xed,0x6e,0x77,0xd1,0xd2,0xc0,
0xed,0xad,0x37,0x9b,0x21,0x51,0xd8,0x9c,0xf1,0xad,0xc0,0xf0,0xc5,0x72,0x00,0x77,
0x04,0x92,0xe4,0x9a,0x50,0x1f,0x00,0xd5,0x52,0x8d,0x50,0x6f,0x8b,0x1e,0x81,0x8b,
0xb5,0xb1,0x37,0xbc,0xb4,0xf0,0xf3,0x9e,0x90,0xf3,0x59,0x52,0xef,0xed,0x78,0xa9,
0x3c,0xa9,0x59,0xe4,0x43,0xc5,0x78,0x13,0xa5,0x50,0x02,0xef,0x1d,0x74,0xc5,0x90,
0xa5,0xae,0x3d,0x99,0x72,0x39,0x51,0x31,0x42,0x0e,0x8e
};

static const guint8 data_broken_signature_block[] = {
0x30,0x82,0x01,0xd7,0x02,0x01,0x01,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9a,0x76,
0xf1,0x62,0xd8,0x7c,0x81,0x2d,0x03,0xf6,0xf0,0x6b,0x9a,0x1f,0xd1,0x69,0x30,0x82,
0x01,0x1b,0x02,0x01,0x01,0x30,0x81,0x9a,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9b,
0xf5,0xc4,0xeb,0xc2,0xf0,0xa0,0x2b,0xde,0xf6,0x37,0x63,0xf6,0x0c,0x30,0x2c,0x04,
0x81,0x80,0x89,0x05,0xd7,0x16,0xe3,0x8d,0x9c,0x88,0x57,0x13,0x10,0xe9,0xb7,0xa0,
0x95,0x91,0x1f,0x85,0xa9,0xa1,0x05,0x63,0x4f,0x04,0x9d,0xa7,0x8f,0x32,0x85,0x6c,
0xb6,0x34,0x23,0x4d,0xa2,0x1a,0xa4,0x07,0xa2,0x03,0x39,0x6a,0xf4,0xbf,0x13,0xf1,
0xa6,0x7d,0xb4,0x38,0xe8,0x5d,0xc7,0x3e,0xfd,0xe5,0x28,0xe0,0xca,0xce,0xf7,0xdf,
0x2d,0xd8,0x5f,0x03,0xed,0x8c,0x96,0xe8,0x1f,0xab,0x4e,0x8e,0xab,0xb8,0x53,0x34,
0x8b,0x2d,0xf0,0x51,0x8a,0x6f,0x13,0x01,0xdf,0xb7,0xf6,0xca,0xcf,0xa4,0x6f,0x4e,
0xee,0xad,0xd1,0xb9,0xfc,0x9b,0x58,0x99,0x0f,0xaf,0xa6,0xc8,0x0a,0xf4,0xf4,0x85,
0xe1,0xed,0xad,0x84,0xc7,0x1f,0x3c,0xcb,0xb5,0xd2,0x5c,0xa0,0x04,0x4f,0x8a,0x46,
0x87,0xab,0x30,0x79,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9a,0x76,0xf1,0x62,0xd8,
0x7c,0x81,0x2d,0x03,0xf6,0xf0,0x6b,0x9a,0x1f,0xd1,0x69,0x04,0x60,0x4a,0x3a,0x07,
0x15,0x1d,0x18,0x6f,0xf6,0x9b,0xe2,0x5d,0x3a,0x0b,0xe3,0xc7,0x4a,0xc3,0xd0,0x22,
0x29,0x4f,0xef,0x47,0xc4,0x0b,0xb7,0x77,0xec,0xc8,0x30,0x5f,0x0e,0xf5,0x9a,0xa3,
0x24,0x69,0x66,0x8c,0x35,0x76,0xdd,0xd6,0x26,0xd1,0x7c,0x7d,0xaf,0xeb,0x73,0x66,
0x02,0x71,0xc4,0x54,0x06,0xd1,0x57,0x95,0x1f,0x18,0xa3,0x00,0x92,0x9c,0xdf,0xf4,
0x51,0xf2,0x7a,0x5a,0x9d,0xe5,0xbe,0xff,0xc7,0x02,0x65,0xff,0xea,0x4f,0xdb,0x41,
0x47,0xd5,0xa1,0x5b,0x11,0x93,0xf8,0xd6,0x28,0xb6,0x4d,0xa6,0x0c,0x30,0x35,0x02,
0x01,0x01,0x04,0x30,0x29,0x92,0x92,0xf0,0x19,0xa9,0xaf,0x5e,0x00,0xf0,0xb4,0xb2,
0x04,0x03,0xea,0x93,0x54,0x80,0xb7,0xa2,0x02,0x64,0x6f,0x3b,0xd3,0x00,0x85,0x09,
0xdc,0x75,0x2f,0x89,0x5f,0xe0,0x67,0x5c,0x81,0x55,0xd8,0x14,0x1e,0x72,0x47,0xf8,
0x62,0x18,0x14,0x0a,0x33,0x65,0x02,0x01,0x01,0x04,0x60,0x8f,0x49,0x88,0xfe,0x68,
/*                     ^ damage (not a sequence tag) */
0xff,0xa2,0x4a,0xc9,0x20,0x6b,0x48,0xb7,0x43,0xe2,0xed,0x6e,0x77,0xd1,0xd2,0xc0,
0xed,0xad,0x37,0x9b,0x21,0x51,0xd8,0x9c,0xf1,0xad,0xc0,0xf0,0xc5,0x72,0x00,0x77,
0x04,0x92,0xe4,0x9a,0x50,0x1f,0x00,0xd5,0x52,0x8d,0x50,0x6f,0x8b,0x1e,0x81,0x8b,
0xb5,0xb1,0x37,0xbc,0xb4,0xf0,0xf3,0x9e,0x90,0xf3,0x59,0x52,0xef,0xed,0x78,0xa9,
0x3c,0xa9,0x59,0xe4,0x43,0xc5,0x78,0x13,0xa5,0x50,0x02,0xef,0x1d,0x74,0xc5,0x90,
0xa5,0xae,0x3d,0x99,0x72,0x39,0x51,0x31,0x42,0x0e,0x8e
};

static const guint8 data_invalid_signature_tag[] = {
0x30,0x82,0x01,0xd7,0x02,0x01,0x01,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9a,0x76,
0xf1,0x62,0xd8,0x7c,0x81,0x2d,0x03,0xf6,0xf0,0x6b,0x9a,0x1f,0xd1,0x69,0x30,0x82,
0x01,0x1b,0x02,0x01,0x01,0x30,0x81,0x9a,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9b,
0xf5,0xc4,0xeb,0xc2,0xf0,0xa0,0x2b,0xde,0xf6,0x37,0x63,0xf6,0x0c,0x30,0x2c,0x04,
0x81,0x80,0x89,0x05,0xd7,0x16,0xe3,0x8d,0x9c,0x88,0x57,0x13,0x10,0xe9,0xb7,0xa0,
0x95,0x91,0x1f,0x85,0xa9,0xa1,0x05,0x63,0x4f,0x04,0x9d,0xa7,0x8f,0x32,0x85,0x6c,
0xb6,0x34,0x23,0x4d,0xa2,0x1a,0xa4,0x07,0xa2,0x03,0x39,0x6a,0xf4,0xbf,0x13,0xf1,
0xa6,0x7d,0xb4,0x38,0xe8,0x5d,0xc7,0x3e,0xfd,0xe5,0x28,0xe0,0xca,0xce,0xf7,0xdf,
0x2d,0xd8,0x5f,0x03,0xed,0x8c,0x96,0xe8,0x1f,0xab,0x4e,0x8e,0xab,0xb8,0x53,0x34,
0x8b,0x2d,0xf0,0x51,0x8a,0x6f,0x13,0x01,0xdf,0xb7,0xf6,0xca,0xcf,0xa4,0x6f,0x4e,
0xee,0xad,0xd1,0xb9,0xfc,0x9b,0x58,0x99,0x0f,0xaf,0xa6,0xc8,0x0a,0xf4,0xf4,0x85,
0xe1,0xed,0xad,0x84,0xc7,0x1f,0x3c,0xcb,0xb5,0xd2,0x5c,0xa0,0x04,0x4f,0x8a,0x46,
0x87,0xab,0x30,0x79,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9a,0x76,0xf1,0x62,0xd8,
0x7c,0x81,0x2d,0x03,0xf6,0xf0,0x6b,0x9a,0x1f,0xd1,0x69,0x04,0x60,0x4a,0x3a,0x07,
0x15,0x1d,0x18,0x6f,0xf6,0x9b,0xe2,0x5d,0x3a,0x0b,0xe3,0xc7,0x4a,0xc3,0xd0,0x22,
0x29,0x4f,0xef,0x47,0xc4,0x0b,0xb7,0x77,0xec,0xc8,0x30,0x5f,0x0e,0xf5,0x9a,0xa3,
0x24,0x69,0x66,0x8c,0x35,0x76,0xdd,0xd6,0x26,0xd1,0x7c,0x7d,0xaf,0xeb,0x73,0x66,
0x02,0x71,0xc4,0x54,0x06,0xd1,0x57,0x95,0x1f,0x18,0xa3,0x00,0x92,0x9c,0xdf,0xf4,
0x51,0xf2,0x7a,0x5a,0x9d,0xe5,0xbe,0xff,0xc7,0x02,0x65,0xff,0xea,0x4f,0xdb,0x41,
0x47,0xd5,0xa1,0x5b,0x11,0x93,0xf8,0xd6,0x28,0xb6,0x4d,0xa6,0x0c,0x30,0x35,0x02,
0x01,0x01,0x04,0x30,0x29,0x92,0x92,0xf0,0x19,0xa9,0xaf,0x5e,0x00,0xf0,0xb4,0xb2,
0x04,0x03,0xea,0x93,0x54,0x80,0xb7,0xa2,0x02,0x64,0x6f,0x3b,0xd3,0x00,0x85,0x09,
0xdc,0x75,0x2f,0x89,0x5f,0xe0,0x67,0x5c,0x81,0x55,0xd8,0x14,0x1e,0x72,0x47,0xf8,
0x62,0x18,0x14,0x0a,0x30,0x65,0x02,0x01,0xff,0x04,0x60,0x8f,0x49,0x88,0xfe,0x68,
/*           damage (signature type = -1) ^^ */
0xff,0xa2,0x4a,0xc9,0x20,0x6b,0x48,0xb7,0x43,0xe2,0xed,0x6e,0x77,0xd1,0xd2,0xc0,
0xed,0xad,0x37,0x9b,0x21,0x51,0xd8,0x9c,0xf1,0xad,0xc0,0xf0,0xc5,0x72,0x00,0x77,
0x04,0x92,0xe4,0x9a,0x50,0x1f,0x00,0xd5,0x52,0x8d,0x50,0x6f,0x8b,0x1e,0x81,0x8b,
0xb5,0xb1,0x37,0xbc,0xb4,0xf0,0xf3,0x9e,0x90,0xf3,0x59,0x52,0xef,0xed,0x78,0xa9,
0x3c,0xa9,0x59,0xe4,0x43,0xc5,0x78,0x13,0xa5,0x50,0x02,0xef,0x1d,0x74,0xc5,0x90,
0xa5,0xae,0x3d,0x99,0x72,0x39,0x51,0x31,0x42,0x0e,0x8e
};

static const guint8 data_broken_signature[] = {
0x30,0x82,0x01,0xd7,0x02,0x01,0x01,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9a,0x76,
0xf1,0x62,0xd8,0x7c,0x81,0x2d,0x03,0xf6,0xf0,0x6b,0x9a,0x1f,0xd1,0x69,0x30,0x82,
0x01,0x1b,0x02,0x01,0x01,0x30,0x81,0x9a,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9b,
0xf5,0xc4,0xeb,0xc2,0xf0,0xa0,0x2b,0xde,0xf6,0x37,0x63,0xf6,0x0c,0x30,0x2c,0x04,
0x81,0x80,0x89,0x05,0xd7,0x16,0xe3,0x8d,0x9c,0x88,0x57,0x13,0x10,0xe9,0xb7,0xa0,
0x95,0x91,0x1f,0x85,0xa9,0xa1,0x05,0x63,0x4f,0x04,0x9d,0xa7,0x8f,0x32,0x85,0x6c,
0xb6,0x34,0x23,0x4d,0xa2,0x1a,0xa4,0x07,0xa2,0x03,0x39,0x6a,0xf4,0xbf,0x13,0xf1,
0xa6,0x7d,0xb4,0x38,0xe8,0x5d,0xc7,0x3e,0xfd,0xe5,0x28,0xe0,0xca,0xce,0xf7,0xdf,
0x2d,0xd8,0x5f,0x03,0xed,0x8c,0x96,0xe8,0x1f,0xab,0x4e,0x8e,0xab,0xb8,0x53,0x34,
0x8b,0x2d,0xf0,0x51,0x8a,0x6f,0x13,0x01,0xdf,0xb7,0xf6,0xca,0xcf,0xa4,0x6f,0x4e,
0xee,0xad,0xd1,0xb9,0xfc,0x9b,0x58,0x99,0x0f,0xaf,0xa6,0xc8,0x0a,0xf4,0xf4,0x85,
0xe1,0xed,0xad,0x84,0xc7,0x1f,0x3c,0xcb,0xb5,0xd2,0x5c,0xa0,0x04,0x4f,0x8a,0x46,
0x87,0xab,0x30,0x79,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9a,0x76,0xf1,0x62,0xd8,
0x7c,0x81,0x2d,0x03,0xf6,0xf0,0x6b,0x9a,0x1f,0xd1,0x69,0x04,0x60,0x4a,0x3a,0x07,
0x15,0x1d,0x18,0x6f,0xf6,0x9b,0xe2,0x5d,0x3a,0x0b,0xe3,0xc7,0x4a,0xc3,0xd0,0x22,
0x29,0x4f,0xef,0x47,0xc4,0x0b,0xb7,0x77,0xec,0xc8,0x30,0x5f,0x0e,0xf5,0x9a,0xa3,
0x24,0x69,0x66,0x8c,0x35,0x76,0xdd,0xd6,0x26,0xd1,0x7c,0x7d,0xaf,0xeb,0x73,0x66,
0x02,0x71,0xc4,0x54,0x06,0xd1,0x57,0x95,0x1f,0x18,0xa3,0x00,0x92,0x9c,0xdf,0xf4,
0x51,0xf2,0x7a,0x5a,0x9d,0xe5,0xbe,0xff,0xc7,0x02,0x65,0xff,0xea,0x4f,0xdb,0x41,
0x47,0xd5,0xa1,0x5b,0x11,0x93,0xf8,0xd6,0x28,0xb6,0x4d,0xa6,0x0c,0x30,0x35,0x02,
0x01,0x01,0x04,0x30,0x29,0x92,0x92,0xf0,0x19,0xa9,0xaf,0x5e,0x00,0xf0,0xb4,0xb2,
0x04,0x03,0xea,0x93,0x54,0x80,0xb7,0xa2,0x02,0x64,0x6f,0x3b,0xd3,0x00,0x85,0x09,
0xdc,0x75,0x2f,0x89,0x5f,0xe0,0x67,0x5c,0x81,0x55,0xd8,0x14,0x1e,0x72,0x47,0xf8,
0x62,0x18,0x14,0x0a,0x30,0x65,0x02,0x01,0x01,0x04,0x60,0xff,0x49,0x88,0xfe,0x68,
/*                                                damage ^^ */
0xff,0xa2,0x4a,0xc9,0x20,0x6b,0x48,0xb7,0x43,0xe2,0xed,0x6e,0x77,0xd1,0xd2,0xc0,
0xed,0xad,0x37,0x9b,0x21,0x51,0xd8,0x9c,0xf1,0xad,0xc0,0xf0,0xc5,0x72,0x00,0x77,
0x04,0x92,0xe4,0x9a,0x50,0x1f,0x00,0xd5,0x52,0x8d,0x50,0x6f,0x8b,0x1e,0x81,0x8b,
0xb5,0xb1,0x37,0xbc,0xb4,0xf0,0xf3,0x9e,0x90,0xf3,0x59,0x52,0xef,0xed,0x78,0xa9,
0x3c,0xa9,0x59,0xe4,0x43,0xc5,0x78,0x13,0xa5,0x50,0x02,0xef,0x1d,0x74,0xc5,0x90,
0xa5,0xae,0x3d,0x99,0x72,0x39,0x51,0x31,0x42,0x0e,0x8e
};

/* Various kinds of broken encrypted data. That is, the original (plain text)
 * data structure is broken. It gets decrypted fine, the error occurs when the
 * decrypted data is being parsed or the signature is being veryfied. */

/* Invalid digest */
static const guint8 data_invalid_signature[] = {
0x30,0x82,0x01,0xd7,0x02,0x01,0x01,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9a,0x76,
0xf1,0x62,0xd8,0x7c,0x81,0x2d,0x03,0xf6,0xf0,0x6b,0x9a,0x1f,0xd1,0x69,0x30,0x82,
0x01,0x1b,0x02,0x01,0x01,0x30,0x81,0x9a,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9b,
0xf5,0xc4,0xeb,0xc2,0xf0,0xa0,0x2b,0xde,0xf6,0x37,0x63,0xf6,0x0c,0x30,0x2c,0x04,
0x81,0x80,0x4c,0xa4,0x8c,0xf6,0x5d,0x27,0x33,0xc9,0x71,0x80,0x15,0x98,0x65,0x16,
0x28,0x39,0xf5,0x6c,0x9d,0x03,0xef,0x8f,0x2b,0x7f,0x8b,0x87,0x01,0x0e,0xdb,0xc9,
0x7a,0x9a,0xbf,0x4b,0x7c,0x06,0x75,0x68,0x31,0x4e,0x16,0x52,0x1b,0xd8,0x1f,0xd7,
0x42,0x43,0x16,0x6e,0x5f,0x86,0x6e,0xf8,0x44,0x8f,0xf7,0xe6,0xe7,0xb0,0x3c,0x75,
0xb1,0x7e,0xe8,0xd0,0xd2,0x1e,0x73,0xe9,0xa7,0x88,0x98,0x5b,0x2c,0xb2,0x31,0xd0,
0x71,0xad,0xa3,0xc3,0x4a,0xc5,0x5f,0x5d,0x1e,0x93,0x06,0xcb,0x3d,0x62,0x0f,0x29,
0x4d,0xe5,0xbb,0x5f,0xe2,0x48,0x92,0x5d,0x76,0xc5,0x21,0x90,0x3e,0x13,0xda,0xac,
0x89,0xdb,0x2f,0x8e,0x6a,0x9a,0xbf,0x93,0xb0,0xf4,0x82,0x25,0xd3,0x45,0x44,0xe7,
0xc3,0xf4,0x30,0x79,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9a,0x76,0xf1,0x62,0xd8,
0x7c,0x81,0x2d,0x03,0xf6,0xf0,0x6b,0x9a,0x1f,0xd1,0x69,0x04,0x60,0x83,0x4a,0x94,
0x33,0x4d,0x47,0xf7,0x89,0x46,0x81,0x32,0x1f,0x56,0xd9,0x8a,0x99,0x7e,0x9a,0x59,
0x47,0x53,0xa0,0x71,0x76,0x97,0x72,0x02,0x3e,0x8f,0x00,0x49,0x08,0x5d,0x11,0xc0,
0xc5,0x00,0xba,0x85,0xfe,0x59,0x44,0x12,0x11,0x1d,0xfe,0xb9,0x85,0x81,0x6b,0x75,
0x04,0x15,0x60,0xaf,0xbe,0x18,0x47,0x41,0xd6,0xad,0xf6,0x9c,0x50,0x16,0x97,0xb8,
0xdc,0x53,0xd5,0xdb,0x29,0xbd,0x65,0x1e,0x91,0x1d,0xe1,0x20,0x6f,0x37,0xf4,0xb6,
0x48,0xc9,0x36,0xe0,0xef,0x28,0xcb,0x3c,0xf5,0x2d,0x5c,0x1a,0xe9,0x30,0x35,0x02,
0x01,0x01,0x04,0x30,0x30,0x05,0x06,0xa6,0x61,0x91,0x31,0x32,0x05,0x22,0x59,0x15,
0x4e,0xe2,0xb3,0x1a,0x68,0xb8,0x4f,0x87,0x7c,0x03,0x61,0x81,0x2a,0xd8,0x7f,0x59,
0x78,0x26,0x1e,0x30,0x0f,0xd1,0xbc,0xf0,0x70,0xef,0x0a,0x32,0x09,0x7e,0xa4,0x9a,
0xaa,0xa5,0xac,0x39,0x30,0x65,0x02,0x01,0x01,0x04,0x60,0x9a,0x49,0xed,0xdc,0x43,
0xe8,0x79,0x5e,0xf5,0x9c,0x64,0x76,0xdc,0x37,0x7c,0xd5,0xc9,0xc6,0x3c,0x46,0xcf,
0xde,0x06,0x18,0x87,0x3b,0x83,0xe9,0x6d,0x1d,0x1c,0x2a,0x3b,0x9e,0x1f,0xeb,0x00,
0x56,0x64,0x85,0x6a,0x09,0xef,0xb6,0x2f,0x84,0x76,0xb8,0xb8,0x34,0x4f,0xb2,0x12,
0xb1,0x41,0x2d,0x7c,0x7d,0x30,0x89,0x5d,0xb0,0x18,0x45,0xe5,0x00,0x30,0xe0,0xac,
0xf5,0xb9,0x7f,0xf0,0xd0,0xfe,0xfb,0x1b,0x67,0x88,0x3c,0x4f,0xb7,0xa9,0xc2,0x5c,
0x53,0xc8,0x5e,0x85,0x02,0x66,0x76,0xf1,0x81,0x0d,0xfc
};

/* Broken sequence header */
static const guint8 data_broken_encrypted_data1[] = {
0x30,0x82,0x01,0xd7,0x02,0x01,0x01,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9a,0x76,
0xf1,0x62,0xd8,0x7c,0x81,0x2d,0x03,0xf6,0xf0,0x6b,0x9a,0x1f,0xd1,0x69,0x30,0x82,
0x01,0x1b,0x02,0x01,0x01,0x30,0x81,0x9a,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9b,
0xf5,0xc4,0xeb,0xc2,0xf0,0xa0,0x2b,0xde,0xf6,0x37,0x63,0xf6,0x0c,0x30,0x2c,0x04,
0x81,0x80,0x97,0xb3,0x4a,0x25,0x97,0x93,0xa1,0x42,0x8e,0xb0,0x82,0x21,0x86,0x22,
0x76,0xbb,0x39,0x46,0x4c,0x29,0x85,0xc1,0x96,0xf7,0x3c,0x6d,0x81,0xdb,0x5c,0xcd,
0x7d,0x3f,0xbc,0x69,0x88,0xee,0x72,0x0b,0xda,0x11,0xd2,0x9b,0x2c,0x46,0xb5,0x29,
0x1a,0x55,0xe6,0x35,0xd8,0xf1,0x8c,0x95,0x01,0xe7,0x37,0x61,0xf6,0xdd,0x99,0x23,
0x01,0x1e,0x81,0x54,0xa2,0xa4,0xfc,0xcb,0xdb,0x37,0x68,0xa3,0x5f,0x86,0xaa,0x37,
0x67,0x02,0xa7,0x1d,0xf7,0x84,0x12,0x36,0x50,0x87,0x6d,0x13,0x35,0xe6,0x51,0x9c,
0xc8,0x2e,0x30,0x88,0xb1,0x1b,0xb4,0xa6,0xbb,0xeb,0x03,0x8c,0x03,0x75,0x62,0x5a,
0xe0,0x45,0xbd,0x69,0xa0,0x0b,0x33,0xc1,0xce,0xc6,0xc8,0xdc,0xe9,0x43,0x7a,0x79,
0xde,0xf6,0x30,0x79,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9a,0x76,0xf1,0x62,0xd8,
0x7c,0x81,0x2d,0x03,0xf6,0xf0,0x6b,0x9a,0x1f,0xd1,0x69,0x04,0x60,0x7e,0x12,0x10,
0xe0,0x46,0x4f,0x6b,0x3f,0x24,0x57,0x3d,0xdb,0xc4,0x81,0xef,0x06,0x3c,0x11,0xcf,
0x86,0x93,0x0c,0x09,0x7c,0xb7,0x22,0x3a,0x2a,0x23,0x14,0xab,0xa9,0x07,0x85,0x7d,
0xed,0xa1,0x38,0xac,0x48,0xbf,0x59,0xaf,0x22,0x67,0x2d,0xdd,0x89,0xb2,0x7a,0x1f,
0xef,0x76,0xbc,0x36,0xbb,0x79,0x02,0xbd,0x50,0xc8,0x9b,0x5f,0x1a,0x30,0x2e,0xfc,
0x0e,0x47,0x1d,0x27,0x61,0x20,0xc6,0xc3,0x0e,0x9b,0xfc,0x1d,0xc7,0xb6,0xd9,0x62,
0x66,0x7c,0x3e,0xc5,0x77,0x9e,0x32,0xec,0xaf,0x06,0x27,0x05,0x35,0x30,0x35,0x02,
0x01,0x01,0x04,0x30,0xff,0xb7,0xbb,0x60,0xbd,0x3d,0x5b,0xb8,0xde,0x33,0x89,0xc2,
0x58,0xf1,0xea,0x24,0xca,0xd5,0xb4,0xba,0x8e,0xf9,0xf5,0x09,0x60,0xff,0xac,0x59,
0x78,0xc9,0x42,0x0a,0xa7,0x5d,0x1e,0x61,0x16,0xa3,0xdf,0x47,0x60,0xb8,0xb5,0x2f,
0x2f,0x6d,0x31,0x0d,0x30,0x65,0x02,0x01,0x01,0x04,0x60,0xc0,0x02,0x07,0x6c,0x5b,
0xde,0x06,0x92,0x2e,0x45,0x1c,0xa7,0x16,0x4c,0x22,0xb4,0xbb,0x84,0x67,0x8a,0x9b,
0x89,0x56,0xe3,0x00,0x33,0x7d,0x1c,0x18,0x7c,0xbc,0x31,0xe1,0x8b,0x1b,0x56,0xed,
0x40,0x68,0xcd,0x0d,0x26,0x86,0x06,0x3b,0x53,0x51,0xcc,0x40,0xfb,0xb8,0x2b,0x8d,
0xaf,0xb6,0xc8,0xf6,0xd3,0x30,0x06,0xef,0xfc,0xc4,0x3c,0xa1,0x7c,0x8e,0x75,0xf0,
0x66,0x8f,0x3c,0x3d,0x64,0x4b,0x1a,0x50,0xcc,0xd6,0xf3,0x2b,0x87,0xd0,0x93,0xb8,
0xc0,0x7c,0xff,0x13,0x2c,0xd0,0x59,0x23,0x9e,0xce,0x13
};

/* Broken format version block */
static const guint8 data_broken_encrypted_data2[] = {
0x30,0x82,0x01,0xd7,0x02,0x01,0x01,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9a,0x76,
0xf1,0x62,0xd8,0x7c,0x81,0x2d,0x03,0xf6,0xf0,0x6b,0x9a,0x1f,0xd1,0x69,0x30,0x82,
0x01,0x1b,0x02,0x01,0x01,0x30,0x81,0x9a,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9b,
0xf5,0xc4,0xeb,0xc2,0xf0,0xa0,0x2b,0xde,0xf6,0x37,0x63,0xf6,0x0c,0x30,0x2c,0x04,
0x81,0x80,0x34,0xac,0xd1,0x9f,0x46,0xba,0x20,0xe7,0xae,0x1b,0xb6,0x95,0x5d,0x4b,
0x3d,0xcd,0x01,0xc3,0x36,0x04,0xf6,0xe7,0x99,0x4a,0x27,0x56,0xc0,0x92,0xff,0x21,
0xe0,0xce,0x86,0xae,0xde,0xbe,0xb9,0xbb,0x0b,0x07,0xad,0xb3,0xc8,0x53,0xac,0x5b,
0x6c,0x6d,0x53,0x83,0x5d,0x7b,0x47,0xdd,0x0b,0x2a,0x58,0x90,0xe3,0xd1,0xc5,0xac,
0x53,0x9e,0x3a,0x91,0xb0,0x13,0x60,0x08,0x88,0xd7,0x09,0x0f,0x5b,0xf1,0x00,0x64,
0x9d,0xbd,0xa6,0x45,0x04,0x63,0xdd,0x6e,0xdc,0x16,0xdf,0x1a,0x50,0x77,0x23,0xb0,
0xd0,0x02,0x1d,0x90,0x68,0x0c,0x24,0xe4,0x17,0x95,0xe7,0x76,0x9a,0x37,0xa8,0x6f,
0x11,0x8b,0x26,0x23,0x3c,0xd4,0x6a,0x76,0x36,0xd0,0xb4,0x0b,0xb5,0x95,0x00,0xd8,
0x92,0xa6,0x30,0x79,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9a,0x76,0xf1,0x62,0xd8,
0x7c,0x81,0x2d,0x03,0xf6,0xf0,0x6b,0x9a,0x1f,0xd1,0x69,0x04,0x60,0xc0,0x1b,0x26,
0x92,0xd8,0xe0,0xa7,0xa5,0x0c,0x21,0x0c,0xb0,0x4f,0x1e,0x3b,0x9d,0x58,0xa2,0x74,
0xff,0xcc,0x85,0xe5,0x9d,0xb2,0x9c,0x06,0x29,0x9f,0x79,0x20,0xdd,0x38,0x4f,0x0a,
0xec,0x16,0xeb,0x15,0xe8,0x3c,0x49,0xad,0x67,0x3c,0x5c,0xaf,0xe1,0x9b,0x1d,0xbf,
0xe0,0x02,0xf5,0x1f,0xc7,0x3f,0xfc,0x3b,0x5d,0xf4,0x04,0x07,0x7a,0xba,0x05,0xe7,
0x0c,0xc0,0x11,0x27,0x51,0x05,0x04,0x21,0x34,0x5d,0x0b,0x71,0x9e,0xcf,0xbc,0xb7,
0x0a,0x9b,0xc0,0x0c,0xfb,0x4a,0x8b,0x77,0x1e,0xc5,0x1a,0xf6,0xc5,0x30,0x35,0x02,
0x01,0x01,0x04,0x30,0x1a,0xba,0x7b,0x2f,0xbe,0xd9,0x64,0x28,0x77,0xa9,0x35,0x41,
0x08,0x0f,0xd8,0x5d,0x63,0x7f,0xe4,0xac,0x21,0xbd,0xae,0x6b,0x03,0xac,0x57,0x6d,
0x58,0xac,0x51,0x18,0xe2,0x7e,0xd7,0x7a,0xf0,0x8c,0xca,0x2f,0xce,0x02,0xcc,0x33,
0x2d,0xf6,0xa1,0x1a,0x30,0x65,0x02,0x01,0x01,0x04,0x60,0x5a,0xa5,0xc7,0x51,0x02,
0x1d,0xa2,0x29,0x89,0x87,0xb2,0x41,0x21,0xa2,0x5a,0xc3,0x1c,0x42,0xed,0xce,0xca,
0xe4,0xf2,0x19,0xff,0x9d,0x7c,0x7c,0x58,0x18,0x33,0x39,0xbc,0x97,0xbe,0xac,0xc6,
0x8e,0x85,0x3a,0x0d,0xc9,0x06,0x87,0x96,0x31,0x2e,0xdf,0xc8,0x23,0xd8,0x14,0x95,
0x0a,0x81,0x9e,0x03,0xed,0x62,0x29,0x73,0x22,0xa8,0xc3,0xdb,0xc6,0x2a,0x7b,0x7f,
0x42,0x8a,0xd6,0x64,0x0b,0xfb,0x27,0x0d,0x7f,0x58,0xf3,0x63,0xff,0x80,0xf0,0x07,
0x67,0x37,0x8c,0xc0,0x81,0xd9,0xde,0x89,0xe5,0x69,0xa3
};

/* Invalid format version */
static const guint8 data_broken_encrypted_data3[] = {
0x30,0x82,0x01,0xd7,0x02,0x01,0x01,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9a,0x76,
0xf1,0x62,0xd8,0x7c,0x81,0x2d,0x03,0xf6,0xf0,0x6b,0x9a,0x1f,0xd1,0x69,0x30,0x82,
0x01,0x1b,0x02,0x01,0x01,0x30,0x81,0x9a,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9b,
0xf5,0xc4,0xeb,0xc2,0xf0,0xa0,0x2b,0xde,0xf6,0x37,0x63,0xf6,0x0c,0x30,0x2c,0x04,
0x81,0x80,0x2f,0x6f,0xfb,0x10,0xe4,0x33,0xa9,0xd5,0x6b,0x86,0x56,0x66,0xf8,0xbe,
0x46,0xc1,0x26,0x2b,0x49,0x41,0x39,0x96,0xb9,0xca,0x1e,0xd3,0x7d,0x8f,0x91,0xb0,
0xaf,0x6b,0x17,0xe1,0x00,0x37,0xca,0x6c,0xb1,0xb4,0x0f,0xab,0x0f,0x48,0xd7,0x73,
0x07,0x46,0x5d,0x4b,0x35,0xbc,0xcc,0xcb,0x99,0x94,0xee,0x08,0x5f,0xf9,0x4f,0xe4,
0x0d,0x7d,0xbf,0xd3,0x63,0xf4,0x46,0xc3,0xb4,0x7d,0xd3,0x5a,0x8a,0x4a,0xf9,0x59,
0x94,0xc2,0x51,0x5c,0x6c,0xdf,0xab,0xc9,0x03,0x46,0x11,0xbe,0xa9,0x90,0xb7,0x42,
0x50,0xe1,0x81,0x68,0x9a,0xa5,0x0b,0xa1,0xd7,0xff,0x0d,0x3f,0xf5,0x74,0x98,0x59,
0xf0,0xe2,0x42,0xe7,0xdd,0x10,0x6b,0xb8,0x19,0x35,0xf2,0x8a,0xee,0x03,0x68,0x47,
0x4c,0xd5,0x30,0x79,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9a,0x76,0xf1,0x62,0xd8,
0x7c,0x81,0x2d,0x03,0xf6,0xf0,0x6b,0x9a,0x1f,0xd1,0x69,0x04,0x60,0x7a,0x23,0x5b,
0x45,0xdd,0x70,0x60,0xe4,0x42,0x9d,0x90,0x99,0xa8,0x07,0x1f,0x4c,0x80,0xc0,0x35,
0xe9,0x54,0x26,0x16,0x61,0x40,0x19,0x23,0x99,0x08,0x59,0xaa,0xea,0x58,0x8e,0xeb,
0x8e,0x58,0xea,0x86,0xc0,0x81,0x2c,0xa6,0xad,0xf1,0x05,0x0e,0x23,0xc5,0x30,0x71,
0x95,0x2b,0x53,0xb0,0xda,0xda,0x62,0xd3,0xf9,0xa7,0x48,0x52,0x6a,0xda,0x61,0x0f,
0x9e,0x2e,0x1e,0x47,0x6e,0xde,0x4f,0x52,0xb0,0xfe,0xd9,0x77,0x12,0xcf,0x48,0xa9,
0x59,0x44,0xaa,0xf4,0xfa,0x0d,0x06,0x53,0xa7,0x4c,0x10,0x87,0x04,0x30,0x35,0x02,
0x01,0x01,0x04,0x30,0x37,0x03,0xc4,0x92,0x99,0xd7,0xfe,0xac,0x57,0x2d,0xde,0x26,
0xd3,0xc5,0x55,0x55,0xed,0x83,0x38,0x52,0xda,0x5c,0xd0,0x40,0x51,0x30,0x18,0xf0,
0x27,0x54,0xb1,0xcf,0xb2,0xd3,0x48,0xb4,0x51,0xde,0x73,0xd8,0x58,0x25,0x21,0x7d,
0x2b,0xaa,0xf7,0x45,0x30,0x65,0x02,0x01,0x01,0x04,0x60,0x5d,0xf0,0x26,0xf3,0x0a,
0xc9,0x5f,0x1a,0xab,0xfd,0xd3,0xb5,0x3d,0x93,0xfb,0x48,0x83,0x96,0xcf,0x8a,0xf4,
0x4e,0xdf,0xfc,0x61,0x25,0x66,0xa0,0x00,0xb9,0x4f,0x2c,0xfe,0x2f,0x84,0xc1,0x86,
0xf5,0x7c,0xa9,0x2d,0xd0,0xec,0x77,0xa3,0x90,0xad,0x99,0x2d,0xf8,0x81,0xc2,0x93,
0x99,0xc2,0x84,0xda,0xac,0x5d,0x11,0xfc,0xbe,0x8e,0xd7,0xea,0xe1,0x60,0x4d,0xc5,
0xfd,0x9b,0x32,0x10,0x43,0xcb,0x8c,0xb0,0x02,0xac,0xd5,0x57,0xe2,0xcb,0x52,0x68,
0x73,0x50,0xb1,0x9b,0x5b,0xdc,0xca,0xde,0x4f,0xeb,0x4e
};

/* Broken octet string tag */
static const guint8 data_broken_encrypted_data4[] = {
0x30,0x82,0x01,0xd7,0x02,0x01,0x01,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9a,0x76,
0xf1,0x62,0xd8,0x7c,0x81,0x2d,0x03,0xf6,0xf0,0x6b,0x9a,0x1f,0xd1,0x69,0x30,0x82,
0x01,0x1b,0x02,0x01,0x01,0x30,0x81,0x9a,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9b,
0xf5,0xc4,0xeb,0xc2,0xf0,0xa0,0x2b,0xde,0xf6,0x37,0x63,0xf6,0x0c,0x30,0x2c,0x04,
0x81,0x80,0x32,0x9f,0xb9,0x82,0xb5,0x40,0x49,0xce,0xa6,0x3e,0x89,0xf3,0x47,0x76,
0xd5,0x24,0xff,0xe2,0x00,0x9a,0x92,0xd8,0xc7,0x7e,0x01,0xf9,0x2c,0x1d,0x73,0x5d,
0xed,0x2f,0xc9,0xf1,0xb0,0x15,0x78,0x0c,0x5b,0x1c,0x87,0x69,0xa9,0x15,0xfb,0x5c,
0x74,0x58,0xef,0x21,0x29,0x24,0xaf,0xc5,0xdb,0x7d,0x2d,0x90,0xbd,0x33,0x77,0xae,
0x6b,0x24,0xe8,0x5b,0x99,0x4c,0x46,0x42,0x46,0x9a,0xf3,0x6e,0x4d,0xc7,0xd3,0x8f,
0xce,0x08,0x61,0x99,0x27,0x62,0x72,0x0e,0x33,0x9a,0x4b,0x28,0x9a,0x55,0x7c,0xef,
0x08,0x35,0xcd,0x9e,0x31,0x0c,0x15,0x7e,0x54,0xe0,0x8d,0x66,0x08,0xf5,0x22,0x44,
0xdb,0x6d,0xff,0x86,0xd6,0xf5,0x5b,0xe2,0x4e,0x8f,0xee,0x0c,0x87,0x4e,0x3a,0x34,
0x09,0x9c,0x30,0x79,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9a,0x76,0xf1,0x62,0xd8,
0x7c,0x81,0x2d,0x03,0xf6,0xf0,0x6b,0x9a,0x1f,0xd1,0x69,0x04,0x60,0x6e,0xac,0xf5,
0x44,0x0c,0xb7,0xd6,0xe3,0x79,0x7e,0x05,0x8b,0x0d,0x04,0x84,0x7d,0x8d,0x75,0xcc,
0x0b,0xfa,0xc1,0xb8,0xb8,0x23,0x4f,0x03,0xab,0x0e,0xcb,0x69,0x48,0xb2,0xab,0xb7,
0xb3,0xc1,0xd7,0x23,0xdd,0x33,0xb5,0x68,0x89,0x64,0x0c,0x8b,0xd2,0xa6,0x1e,0xb2,
0xd7,0xec,0x80,0x88,0xba,0x89,0x50,0x37,0xb2,0x5f,0x5f,0xf2,0x22,0xb7,0x6f,0x29,
0xf4,0x7a,0x73,0x6d,0xa0,0x29,0x26,0x08,0x10,0x06,0x1c,0xdd,0x9f,0x71,0xe7,0x97,
0x85,0x07,0xb9,0x06,0x0e,0x30,0x16,0x17,0x48,0x06,0xdc,0xc2,0x66,0x30,0x35,0x02,
0x01,0x01,0x04,0x30,0x75,0x34,0x34,0x80,0xc4,0xb9,0xd6,0xab,0x41,0xc3,0x57,0x1f,
0xc3,0x17,0x1e,0xa1,0xd4,0xeb,0xcf,0x9a,0x16,0x15,0xd6,0x81,0x41,0x3c,0x8f,0x2a,
0xe8,0x10,0x2d,0x0c,0x10,0x34,0xfe,0x9e,0x6d,0xe7,0x18,0xbd,0x1b,0x5a,0x18,0x4b,
0xca,0xe5,0xbd,0x20,0x30,0x65,0x02,0x01,0x01,0x04,0x60,0x09,0x4f,0x1e,0xdd,0x43,
0xa5,0x3b,0x3c,0x5c,0x0e,0xdd,0x26,0xc4,0xfd,0x2d,0x7e,0x6d,0x7f,0xa6,0x96,0x0a,
0x8c,0xa2,0xf0,0xd0,0xd1,0x8e,0xce,0x86,0x3c,0x7f,0xdc,0x03,0x01,0xf1,0x5f,0xe9,
0xec,0xc3,0x43,0xf7,0x5d,0x2d,0x26,0x8d,0xb3,0x25,0xfc,0x36,0x8d,0x53,0xa8,0x3f,
0x04,0x57,0x3c,0xd4,0xfa,0xbd,0x28,0xec,0x26,0x90,0xc3,0x4a,0x89,0xc1,0xe0,0x2b,
0x57,0xf9,0x50,0x60,0x7f,0xc4,0xae,0x3a,0xfa,0xc1,0x7f,0x5f,0xf5,0xc9,0xdc,0x5e,
0x29,0xe0,0x7a,0x2a,0xbf,0xa8,0xd3,0xc0,0xcb,0xf5,0xf6
};

/* Broken octet string length */
static const guint8 data_broken_encrypted_data5[] = {
0x30,0x82,0x01,0xd7,0x02,0x01,0x01,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9a,0x76,
0xf1,0x62,0xd8,0x7c,0x81,0x2d,0x03,0xf6,0xf0,0x6b,0x9a,0x1f,0xd1,0x69,0x30,0x82,
0x01,0x1b,0x02,0x01,0x01,0x30,0x81,0x9a,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9b,
0xf5,0xc4,0xeb,0xc2,0xf0,0xa0,0x2b,0xde,0xf6,0x37,0x63,0xf6,0x0c,0x30,0x2c,0x04,
0x81,0x80,0x94,0xa7,0x6b,0xa2,0x22,0x39,0x78,0xaf,0x55,0x51,0x02,0x99,0x0d,0x49,
0x63,0x53,0xa9,0x16,0x58,0xd8,0x21,0xa3,0xa4,0x16,0x82,0x95,0xb7,0xb6,0xda,0x0d,
0x19,0x0d,0xed,0x1c,0xd2,0x58,0xc6,0xa6,0xd3,0xea,0xfe,0xf6,0xf5,0x23,0x42,0x5c,
0x9b,0x17,0x86,0xd1,0x6b,0x84,0x2d,0x51,0xcd,0xae,0x8b,0x44,0x7d,0x0b,0x62,0xdd,
0x1b,0x87,0xfc,0xca,0x73,0xf6,0x6e,0x6c,0x23,0xf9,0xfd,0xc1,0x04,0xb5,0x27,0x85,
0x3c,0xe1,0xbb,0x6a,0xa2,0x7d,0x19,0xb5,0x98,0x36,0xbd,0x9a,0x8a,0x92,0xae,0xcc,
0xd6,0x94,0x16,0x57,0x74,0x80,0xd3,0x1f,0x48,0xa0,0x0a,0x6a,0x0c,0x20,0xb7,0xc3,
0x0c,0xf4,0x50,0xc3,0xca,0x50,0x32,0xd9,0xb4,0xc6,0xd5,0x87,0xd7,0x2b,0x52,0x34,
0xb3,0xfa,0x30,0x79,0x30,0x15,0x02,0x01,0x01,0x04,0x10,0x9a,0x76,0xf1,0x62,0xd8,
0x7c,0x81,0x2d,0x03,0xf6,0xf0,0x6b,0x9a,0x1f,0xd1,0x69,0x04,0x60,0x14,0xc1,0xf3,
0x05,0xf5,0x42,0xdb,0xcc,0xd7,0x35,0x92,0x4d,0xc9,0xce,0x4d,0x71,0xd4,0xcf,0x8e,
0x0a,0x98,0x0c,0x86,0xbb,0x1f,0xa2,0xf1,0x54,0x0a,0x59,0x84,0x65,0x23,0x66,0x60,
0xe4,0xe4,0x9a,0x78,0x96,0x6d,0x76,0xc9,0x35,0x07,0x6c,0xe5,0x4c,0x9f,0x8b,0xdb,
0x98,0xb2,0x34,0x35,0x3b,0xfe,0x1a,0xc6,0x1a,0x62,0xdf,0x2f,0x9b,0x5d,0x9c,0x4d,
0xa3,0x64,0x0a,0x3f,0x61,0xc7,0xea,0xb0,0xf5,0x78,0x31,0x23,0xdf,0x26,0x54,0x76,
0x91,0x27,0x10,0x28,0xca,0xac,0x20,0xd4,0xa6,0x94,0x02,0x76,0xb5,0x30,0x35,0x02,
0x01,0x01,0x04,0x30,0x48,0x76,0x2d,0x56,0xe6,0x0f,0x2c,0xbc,0xde,0x6f,0x32,0x3c,
0xbf,0x2d,0x6b,0xe3,0xe8,0x13,0x05,0xae,0xff,0x5b,0x51,0x50,0x07,0x0f,0x4c,0x5c,
0x6b,0x89,0x33,0x23,0x80,0xc6,0xff,0xdd,0x1a,0x10,0x13,0x70,0xc5,0x80,0x64,0xf1,
0x1d,0x5b,0x4e,0x59,0x30,0x65,0x02,0x01,0x01,0x04,0x60,0x40,0xd5,0x4f,0x06,0xf2,
0x32,0xce,0x2a,0x25,0xe0,0x8c,0xe7,0xf9,0x56,0x9b,0xef,0x6d,0x22,0x02,0xed,0x7a,
0xf6,0x25,0x87,0xc3,0x4b,0x01,0x65,0xd6,0x75,0xd1,0x8a,0x41,0xb7,0xbd,0x34,0xb3,
0x28,0xa2,0x41,0xc5,0x16,0xce,0x6a,0xed,0x6b,0xb9,0xef,0xed,0xcf,0xfa,0x57,0x5f,
0x5f,0x17,0xc5,0xbe,0xea,0x11,0xf0,0x88,0x55,0x37,0x32,0x04,0xc4,0x61,0xa4,0x7f,
0x6e,0x66,0x9e,0x83,0x1e,0x9c,0x34,0x95,0x7e,0xea,0x8b,0x22,0xf9,0x4c,0xf2,0x1a,
0x65,0xa2,0x78,0xdc,0xfe,0x6b,0xab,0x76,0xd9,0x3d,0x50
};

static const TestFoilMsgDecryptError decrypt_error_tests [] = {
    {
        TEST_("BrokenSequenceHeader"),
        { TEST_ARRAY_AND_SIZE(data_broken_sequence_header) },
        { NULL, NULL, "rsa-1024", NULL }
    },{
        TEST_("BrokenFormatVersion"),
        { TEST_ARRAY_AND_SIZE(data_broken_format_version) },
        { NULL, NULL, "rsa-1024", NULL }
    },{
        TEST_("InvalidFormatVersion"),
        { TEST_ARRAY_AND_SIZE(data_invalid_format_version) },
        { NULL, NULL, "rsa-1024", NULL }
    },{
        TEST_("BrokenSenderKey"),
        { TEST_ARRAY_AND_SIZE(data_broken_sender_key) },
        { NULL, NULL, "rsa-1024", NULL }
    },{
        TEST_("InvalidSenderKeyFormat"),
        { TEST_ARRAY_AND_SIZE(data_invalid_sender_key_format) },
        { NULL, NULL, "rsa-1024", NULL }
    },{
        TEST_("BrokenEncryptedKeyHeader"),
        { TEST_ARRAY_AND_SIZE(data_broken_encrypted_key_header) },
        { NULL, NULL, "rsa-1024", NULL }
    },{
        TEST_("BrokenEncryptedKeyType"),
        { TEST_ARRAY_AND_SIZE(data_broken_encrypted_key_type) },
        { NULL, NULL, "rsa-1024", NULL }
    },{
        TEST_("InvalidEncryptedKeyType"),
        { TEST_ARRAY_AND_SIZE(data_invalid_encrypted_key_type) },
        { NULL, NULL, "rsa-1024", NULL }
    },{
        TEST_("BrokenFingerprintSequence"),
        { TEST_ARRAY_AND_SIZE(data_broken_fingerprint_sequence) },
        { NULL, NULL, "rsa-1024", NULL }
    },{
        TEST_("BrokenFingerprint1"),
        { TEST_ARRAY_AND_SIZE(data_broken_fingerprint1) },
        { NULL, NULL, "rsa-1024", NULL }
    },{
        TEST_("BrokenFingerprint2"),
        { TEST_ARRAY_AND_SIZE(data_broken_fingerprint2) },
        { NULL, NULL, "rsa-1024", NULL }
    },{
        TEST_("BrokenFingerprint3"),
        { TEST_ARRAY_AND_SIZE(data_broken_fingerprint3) },
        { NULL, NULL, "rsa-1024", NULL }
    },{
        TEST_("BrokenFingerprint4"),
        { TEST_ARRAY_AND_SIZE(data_broken_fingerprint4) },
        { NULL, NULL, "rsa-1024", NULL }
    },{
        TEST_("InvalidFingerprintFormat"),
        { TEST_ARRAY_AND_SIZE(data_invalid_fingerprint_format) },
        { NULL, NULL, "rsa-1024", NULL }
    },{
        TEST_("BrokenEncryptedKey"),
        { TEST_ARRAY_AND_SIZE(data_broken_encrypted_key) },
        { NULL, NULL, "rsa-1024", NULL }
    },{
        TEST_("BrokenEncryptedDataBlock"),
        { TEST_ARRAY_AND_SIZE(data_broken_encrypted_data_block) },
        { NULL, NULL, "rsa-1024", NULL }
    },{
        TEST_("InvalidEncryptedDataTag"),
        { TEST_ARRAY_AND_SIZE(data_invalid_encrypted_data_tag) },
        { NULL, NULL, "rsa-1024", NULL }
    },{
        TEST_("BrokenSignatureBlock"),
        { TEST_ARRAY_AND_SIZE(data_broken_signature_block) },
        { NULL, NULL, "rsa-1024", NULL }
    },{
        TEST_("InvalidSignatureTag"),
        { TEST_ARRAY_AND_SIZE(data_invalid_signature_tag) },
        { NULL, NULL, "rsa-1024", NULL }
    },{
        TEST_("BrokenEncryptedData1"),
        { TEST_ARRAY_AND_SIZE(data_broken_encrypted_data1) },
        { NULL, NULL, "rsa-1024", NULL }
    },{
        TEST_("BrokenEncryptedData2"),
        { TEST_ARRAY_AND_SIZE(data_broken_encrypted_data2) },
        { NULL, NULL, "rsa-1024", NULL }
    },{
        TEST_("BrokenEncryptedData3"),
        { TEST_ARRAY_AND_SIZE(data_broken_encrypted_data3) },
        { NULL, NULL, "rsa-1024", NULL }
    },{
        TEST_("BrokenEncryptedData4"),
        { TEST_ARRAY_AND_SIZE(data_broken_encrypted_data4) },
        { NULL, NULL, "rsa-1024", NULL }
    },{
        TEST_("BrokenEncryptedData5"),
        { TEST_ARRAY_AND_SIZE(data_broken_encrypted_data5) },
        { NULL, NULL, "rsa-1024", NULL }
    }
};

static const TestFoilMsgDecryptError verify_error_tests [] = {
    {
        TEST_("WrongPublicKey"),
        { TEST_ARRAY_AND_SIZE(valid_data) },
        { NULL, "rsa-1024.pub", "rsa-1024", NULL }
    },{
        TEST_("BrokenSignature"),
        { TEST_ARRAY_AND_SIZE(data_broken_signature) },
        { NULL, "rsa-768.pub", "rsa-1024", NULL }
    },{
        TEST_("InvalidSignature"),
        { TEST_ARRAY_AND_SIZE(data_invalid_signature) },
        { NULL, "rsa-768.pub", "rsa-1024", NULL }
    }
};

static const TestFoilMsgGarbage foilmsg_garbage_tests[] = {
    { TEST_("DecryptEmpty"), "" },
    { TEST_("DecryptGarbage"), "GARBAGE  " },
    { TEST_("DecryptNoData"), "FOILMSG   " }
};

int main(int argc, char* argv[])
{
    guint i;
    g_test_init(&argc, &argv, NULL);
    g_test_add_func(TEST_("Invalid"), test_foilmsg_invalid);
    g_test_add_func(TEST_("Options"), test_foilmsg_options);
    g_test_add_func(TEST_("DecryptFile"), test_foilmsg_decrypt_file);
    g_test_add_func(TEST_("EncryptSelf"), test_foilmsg_encrypt_self);
    for (i = 0; i < G_N_ELEMENTS(foilmsg_convert_tests); i++) {
        const TestFoilMsgConvertToBinary* test = foilmsg_convert_tests + i;
        g_test_add_data_func(test->name, test, test_foilmsg_to_binary);
    }
    for (i = 0; i < G_N_ELEMENTS(foilmsg_tests); i++) {
        const TestFoilMsg* test = foilmsg_tests + i;
        g_test_add_data_func(test->name, test, test->fn);
    }
    for (i = 0; i < G_N_ELEMENTS(decrypt_error_tests); i++) {
        const TestFoilMsgDecryptError* test = decrypt_error_tests + i;
        g_test_add_data_func(test->name, test, test_foilmsg_decrypt_error);
    }
    for (i = 0; i < G_N_ELEMENTS(verify_error_tests); i++) {
        const TestFoilMsgDecryptError* test = verify_error_tests + i;
        g_test_add_data_func(test->name, test, test_foilmsg_verify_error);
    }
    for (i = 0; i < G_N_ELEMENTS(foilmsg_garbage_tests); i++) {
        const TestFoilMsgGarbage* test = foilmsg_garbage_tests + i;
        g_test_add_data_func(test->name, test, test_foilmsg_decrypt_garbage);
    }
    return test_run();
}

/*
 * Local Variables:
 * mode: C
 * c-basic-offset: 4
 * indent-tabs-mode: nil
 * End:
 */
